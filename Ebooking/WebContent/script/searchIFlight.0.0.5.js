/*from tccdn minify at 2013-12-27 12:48:22,file：/cn/c/s/2013/searchIflight.0.0.5.js?v=2013091001*/
fish.ready(function(){fish.require("iFlightSearch",function(){iFlightSearchBox=fish.iFlightSearch({ileaveCityElem:"#ileaveCityDiv",iarriveCityElem:"#iarriveCityDiv",ileaveTimeElem:"#ileaveTimeDiv",ibackTimeElem:"#ibackTimeDiv",ihistoryElem:"#searchHistoryDiv",ihistorySearchElem:"#historySearch",icabinTypeElem:"#airIntSele1",ipassengersTypeElem:"#airIntSele2",iadultElem:"#airIntSele3",ichildElem:"#airIntSele4",ichangeCityElem:"#changeiFlightSearchCity",icontentElem:"#tab_top_airplane",isubmitElem:"#iflightSubmit",isearchSubmitUrl:fish.one("#iflightSubmit").attr("data-submit-url"),isearchDataUrl:fish.one("#iflightSubmit").attr("data-citydata-url"),ioneWayElem:"#airplaneInternatRadio1",ireturnWayElem:"#airplaneInternatRadio2",iconnectWayElem:"#airplaneInternatRadio3"})})});(function(){var x,n,y,o,v,w,p,B,m,r,q,A,C,s,t,D,E,b,F,c,e,H,a,f,d=false,l=6,g="IfSearchHis",i="MULTIAIRPLANE",h="AIRPLANEINTERNATCITYNAME";var u={searchType:2,ontypechange:function(J){},onsubmitsuccess:function(J){},onsubmit:function(){return true}};function G(J){var S=[],L=null,K=fish.all("input, select",J);for(var M=0,O=K.length;M<O;M++){L=K[M];if(L.name===""){continue}switch(L.type){case"select-multiple":for(var N=0,Q=L.options.length;N<Q;N++){var P=L.options[N];if(P.selected){var R="";if(P.hasAttribute){R=(P.hasAttribute("value")?P.value:P.text)}else{R=(P.attributes.value.specified?P.value:P.text)}S.push(encodeURIComponent(L.name)+"="+encodeURIComponent(R))}}break;case"radio":if(L.checked){S.push(encodeURIComponent(L.name)+"="+encodeURIComponent(L.value))}break;case"button":break;case"checkbox":if(L.checked){S.push(encodeURIComponent(L.name)+"="+encodeURIComponent(L.value))}break;default:S.push(encodeURIComponent(L.name)+"="+encodeURIComponent(L.value))}}return S.join("&")}function k(M){var K=document.createElement("div"),J=[];fish.all(K).html(M);for(var L=0;L<K.childNodes.length;L++){if(K.childNodes[L].nodeType===1){J.push(K.childNodes[L])}}K=null;return fish.all(J)}function j(M){var J=fish.all(M.elem);if(!J[0]){return}var K={template:'<div class="search_warn none" style="position:absolute"><span class="arrow"></span><span class="info">{{=it.tips}}</span></div>',related:"",holder:fish.all("input",J).attr("holder"),nullTips:fish.all("input",J).attr("nulltips"),elem:null};var L=fish.lang.proto(I);fish.lang.extend(K,M);fish.lang.extend(L,K);L.__input=fish.all("input",fish.dom(L.elem));L.__select=fish.all("select",fish.dom(L.elem));L.__elem=J;L.__input.hover(function(){L.__input.addClass("focus")},function(){if(L.__input.attr("focusnow")!=="true"){L.__input.removeClass("focus")}});L.__input.on("focus",function(){this.setAttribute("focusnow","true");L.__input.addClass("focus");L.checkInputStyle();L.hideWarn()}).on("blur",function(){this.setAttribute("focusnow","false");L.__input.removeClass("focus");this.value=fish.trim(this.value);if(this.value===""){this.value=L.holder}L.checkInputStyle()}).on("click",function(){this.value=fish.trim(this.value);L.checkInputStyle();this.select()}).on("keyup",function(O){var N=fish.getEvent(O);if(N.keyCode){code=N.keyCode}else{if(N.which){code=N.which}}if(code==13){fish.preventDefault(N)}L.checkInputStyle()});fish.one("body").on("resize",function(){L.resetPosition()});return L}var I={getInputTopLeft:function(){return this.__input.offset()},getInputWidth:function(){return this.__input.width()},getInputHeight:function(){return this.__input.height()},getInputValue:function(){return this.__input.val()},setInputValue:function(J){this.__input.val(J)},hide:function(){this.__elem.css("display:none")},show:function(){this.__elem.css("display:block")},getSelectTopLeft:function(){return this.__select.offset()},getSelectWidth:function(){return this.__select.width()},getSelectHeight:function(){return this.__select.height()},setSelectValue:function(J){return this.__select.val(J)},getSelectValue:function(){return this.__select.val()},warn:function(J){if(!this.warnElem){this.warnElem=k(fish.template(this.template,{tips:J}));fish.one("body").html("top",this.warnElem);this.warnElem.effect({elem:fish.all(this.related),interShow:false})}else{fish.one(".info",this.warnElem).html(J)}if(this.__input.length){this.resetPosition(false)}else{if(this.__select.length){this.resetPosition(true)}}this.warnElem.css("display:block")},hideWarn:function(){this.warnElem&&this.warnElem.css("display:none")},checkNull:function(){var J=this.getInputValue();J=fish.trim(J);this.setInputValue(J);if(J===""||J===this.holder){this.warn(this.nullTips);return false}else{this.hideWarn();return true}},resetPosition:function(K){if(this.warnElem){var L=K?this.getSelectTopLeft():this.getInputTopLeft(),O=K?this.getSelectWidth():this.getInputWidth(),J=K?this.getSelectHeight():this.getInputHeight(),M=L.left+O+5,N=L.top+parseInt(J/2,10)-13;this.warnElem.css("left:"+M+"px;top:"+N+"px")}},checkInputStyle:function(){if(this.__input.val()!=this.holder){this.setFullStyle()}else{this.setEmptyStyle()}},setEmptyStyle:function(){this.__input.css("color:#999")},setFullStyle:function(){this.__input.css("color:#333")},clear:function(){this.__input.val(this.holder)},checkIfDisplay:function(){if(fish.one(this.elem).getCss("display")!="none"){return true}else{return false}}};function z(){var av=fish.one(q),au=fish.one(D),aw=fish.dom(t),ax=fish.one(".iFlightDiv",aw),L=fish.one(".airplane_tab",aw),aA=fish.one(".multiTips",aw),aG=fish.one(".onepass",aw),aP=fish.one(".mutilpass",aw),az=fish.all(".high_search dl",aw),ay=fish.one(".high_search_a",aw),J=fish.one("#iflight_mult .add_btn"),aB=fish.one("#multiBubble"),aI=fish.one("#soso_17u"),a1=fish.one("#soso_17u .search_main"),aH=fish.one("#soso_tab_content"),ba=fish.one("#soso_17u .search_main .sp"),a9=fish.one("#soso_top_title"),aF,aC=[];av.on("click",function(){var bf=E.getInputValue(),be=b.getInputValue();E.setInputValue(be);b.setInputValue(bf)}).hover(function(){fish.one(this).addClass("changeHover")},function(){fish.one(this).removeClass("changeHover")});function a6(){av.css("display:block")}function am(){av.css("display:none")}ay.on("click",function(){if(fish.one(this).hasClass("high_search_show")){fish.one(this).removeClass("high_search_show").addClass("high_search_hide");az.removeClass("none");fish.one(this.parentNode).addClass("add_border")}else{fish.one(this).removeClass("high_search_hide").addClass("high_search_show");az.addClass("none");fish.one(this.parentNode).removeClass("add_border")}});function aZ(){var be=aA.offset();aB.css("top:"+(be.top+22)+"px;left:"+be.left+"px")}aZ();aB.effect({type:"hover",elem:aA,interFn:aZ});var P=fish.all(A+","+C+","+s).on("click",function(){aW();d=true});u.changeSearchType=function(bf,be){if(bf==1){fish.dom(A).checked="checked"}else{if(bf==2){fish.dom(C).checked="checked"}else{if(bf==3){fish.dom(s).checked="checked"}}}aW();be&&be()};function a0(){if(u.searchType===3){au.addClass("multiBtn")}else{au.removeClass("multiBtn")}}fish.one("#soso_17u").on("click",function(be){if(fish.one("#soso_17u #soso_tab_content .ariplane_div").hasClass("none")){fish.one("#soso_17u").css("position:static;")}else{fish.one("#soso_17u").css("position:absolute;")}});fish.one("#soso_17u").on("click",function(be){var bf=fish.one(fish.getTarget(be));if(bf.hasClass("hotel_at")||bf.hasClass("high_search_show")||/^(flightA)$/.test(fish.getTarget(be).id)){if(bf.hasClass("atop_airplane")){aX("ok",bf);if(u.searchType===3){if(fish.browser("ms",7)){fish.one(L).css("width:"+682+"px;")}}}else{aX("non",null)}}else{if(/^(isearchIfligt)$/.test(fish.getTarget(be).id)){if(u.searchType===3){if(fish.browser("ms",7)){fish.one(L).css("width:"+682+"px;")}}}else{aX("ok",bf)}}});function aX(bf,bi){var be=fish.one("#soso_17u").height(),bh=a9.height(),bg=be-10-bh;if(bf==="non"){fish.one("#soso_17u div.search_main span.sp").css("height:"+45+"px;");if(fish.browser("ms",7)){fish.one(L).css("width:"+308+"px;")}}else{if(bi.hasClass("dele_btn")){if(fish.browser("ms",7)||fish.browser("ms",6)){if(fish.all("#iflight_mult .flightLine")[2].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+45+"px;")}else{if(fish.all("#iflight_mult .flightLine")[3].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+61+"px;")}else{if(fish.all("#iflight_mult .flightLine")[4].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+121+"px;")}else{if(fish.all("#iflight_mult .flightLine")[5].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+181+"px;")}}}}}else{if(fish.all("#iflight_mult .flightLine")[3].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+45+"px;")}else{if(fish.all("#iflight_mult .flightLine")[4].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+105+"px;")}else{if(fish.all("#iflight_mult .flightLine")[5].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+165+"px;")}}}}}else{fish.one("#soso_17u div.search_main span.sp").css("height:"+bg+"px;")}}}function aW(){fish.all(".onepass, .multipass",aw).addClass("none");fish.all(".multipass iframe",aw).removeClass("cover_select");a6();var be=1;if(fish.dom(A).checked){be=1;fish.all(".onepass",aw).removeClass("none");if(fish.one(".need_btn_search",aw).hasClass("need_btn_dc")){fish.one(".need_btn_search",aw).removeClass("need_btn_dc");fish.one(".need_a",aw).removeClass("need_dc_a")}aE(function(){aF&&aF.hideBackTime()});if(fish.one(".high_search_a",aw).hasClass("high_search_show")){fish.one("#soso_17u div.search_main span.sp").css("height:"+45+"px;")}if(fish.browser("ms",7)){fish.one(L).css("width:"+308+"px;")}}else{if(fish.dom(C).checked){be=2;fish.all(".onepass",aw).removeClass("none");if(fish.one(".need_btn_search",aw).hasClass("need_btn_dc")){fish.one(".need_btn_search",aw).removeClass("need_btn_dc");fish.one(".need_a",aw).removeClass("need_dc_a")}aE(function(){aF&&aF.showBackTime()});if(fish.one(".high_search_a",aw).hasClass("high_search_show")){fish.one("#soso_17u div.search_main span.sp").css("height:"+45+"px;")}if(fish.browser("ms",7)){fish.one(L).css("width:"+308+"px;")}}else{if(fish.dom(s).checked){be=3;fish.all(".multipass",aw).removeClass("none");if(!fish.one(".need_btn_search",aw).hasClass("need_btn_dc")){fish.one(".need_btn_search",aw).addClass("need_btn_dc");fish.one(".need_a",aw).addClass("need_dc_a")}am();aD();if(fish.all("#iflight_mult .flightLine")[3].style.display==="none"){fish.one("#soso_17u div.search_main span.sp").css("height:"+45+"px;")}if(fish.browser("ms",7)){fish.one(L).css("width:"+682+"px;")}}}}u.searchType=be;iflightMoreLine();a0();return be}var R=location.hostname.indexOf(".17u.cn")>-1?".17u.cn":location.hostname;u.getSearchHistory=function(be){var bg,bh,bf,bt,bu,bs=[];if(be){bf=be}else{bh=fish.cookie.get(h);bg=fish.cookie.get(g);bh=(bh&&bh!==undefined)?bh:"";bg=(bg&&bg!==undefined)?bg:"";if(bg===""){if(bh===""){bf=""}else{bf=bh}}else{if(bh===""){bf=bg}else{bf=bh+"***"+bg}}}if(bf){bt=bf.split("***");for(var br=0,bk=bt.length;br<bk;br++){if(bt[br]){bu=bt[br].split("$");var bv=bu[3];if(bv==3){var bm=bu[0].split(","),bl=bu[1].split(","),bn=bu[4].split(","),bp=bn[0].split("-"),bo=bp[1]+"-"+bp[2],bq=bl.length;bs.push({firstLeaveCity:bm[0],lastArriveCity:bl[bq-1],firstLeaveTime:bo,leaveCity:bu[0],arriveCity:bu[1],transitCity:bu[2],type:bu[3],leaveTime:bu[4],backTime:bu[5],transitTime:bu[6],cabinType:bu[7],passengersType:bu[8],adult:bu[9],child:bu[10],price:bu[11]?bu[11]:""})}else{var bj=bu[4].split("-"),bi=bj[1]+"-"+bj[2];bs.push({leaveCity:bu[0],arriveCity:bu[1],transitCity:bu[2],type:bu[3],firstLeaveTime:bi,leaveTime:bu[4],backTime:bu[5],transitTime:bu[6],cabinType:bu[7],passengersType:bu[8],adult:bu[9],child:bu[10],price:bu[11]?bu[11]:""})}}}}return bs};function bd(be){be=fish.trim(be);if(be==="时间/日期"||be==="城市名"){be=""}return be}function aM(bh,be){var bi=[],bj=u.searchType;for(var bg=0,bf=bh.length;bg<bf;bg++){bi[bg]=[bh[bg].leaveCity,bh[bg].arriveCity,bh[bg].transitCity,bh[bg].type,bh[bg].leaveTime,bh[bg].backTime,bh[bg].transitTime,bh[bg].cabinType,bh[bg].passengersType,bh[bg].adult,bh[bg].child,bh[bg].price].join("$")}return bi.join("***")}function ad(bk){if(u.searchType==3){var bf=[],be=[],bg=[],bi,bh,bj;bk.forEach(function(bl){bf.push(bl.leaveCity.getInputValue());be.push(bl.arriveCity.getInputValue());bg.push(bl.leaveTime.getInputValue())});bi=bf.join(",");bh=be.join(",");bj=bg.join(",");ae(bi,bh,u.searchType,bj,"","Y","1","1","0");ac(bk)}else{ae(E?E.getInputValue():"",b?b.getInputValue():"",u.searchType?u.searchType:"",F?F.getInputValue():"",(u.searchType===2)?(c?c.getInputValue():""):"",e?e.getSelectValue():"",H?H.getSelectValue():"",a?a.getSelectValue():"",f?f.getSelectValue():"")}}function ae(bj,bf,bm,bk,bg,bh,bl,be,bi){cookieValue=[bd(bj),bd(bf),"",bm,bd(bk),bd(bg),"",bh,bl,be,bi].join("$");a2(cookieValue)}function ac(bg){var be,bf=[];bg.forEach(function(bh){bf.push([bh.leaveCity.getInputValue(),bh.arriveCity.getInputValue(),bh.leaveTime.getInputValue()].join("|"))});be=bf.join("@");fish.cookie.set({name:i,value:be,days:7,path:R===".17u.cn"?"/iflight":"/",domain:R})}function a2(be){var bh=fish.cookie.get(h),bf,bn,bl,bg=fish.cookie.get(g),bk="",bi,bj,bm;bh=(bh&&bh!==undefined)?bh:"";bg=(bg&&bg!==undefined)?bg:"";if(bg===""){if(bh===""){bf=""}else{bf=bh}}else{if(bh===""){bf=bg}else{bf=bh+"***"+bg}}if(bf==""||bf.indexOf(be)!=0){bf=be+"***"+bf;bn=u.getSearchHistory(bf);if(bn.length>l){bn.pop()}bl=bn.shift();fish.cookie.set({name:h,value:aM([bl]),days:7,path:"/",domain:R});fish.cookie.set({name:g,value:aM(bn),days:7,path:"/",domain:R})}}var ao=fish.one(w),ap=fish.one(v),an=fish.all(w+","+v),aq='<li><a class="history_line" href="#" h_leave="{{=it.leaveCity}}" h_arrive="{{=it.arriveCity}}" h_transit="{{=it.transitCity}}"  h_leaveTime="{{=it.leaveTime}}" h_backTime="{{=it.backTime}}" h_transTime="{{=it.transitTime}}" h_type="{{=it.type}}" h_cabinType="{{=it.cabinType}}" h_passengersType="{{=it.passengersType}}" h_adult="{{=it.adult}}" h_child="{{=it.child}}" title="{{=it.leaveCity}}到{{=it.arriveCity}} {{=it.firstLeaveTime}} 出发" href="javascript:;">{{?it.type == 1}}单程{{??it.type == 2}}往返{{??it.type == 3}}多程{{?}}&nbsp;&nbsp;&nbsp;{{?it.type == 1}}{{=it.leaveCity}}→{{=it.arriveCity}}&nbsp;&nbsp;&nbsp;{{=it.firstLeaveTime}}{{??it.type == 2}}{{=it.leaveCity}}<span class="arrowBoth">&nbsp;&nbsp;&nbsp;</span>{{=it.arriveCity}}&nbsp;&nbsp;&nbsp;{{=it.firstLeaveTime}}{{??it.type == 3}}{{=it.firstLeaveCity}}<span class="arrowMore">&nbsp;&nbsp;&nbsp;</span>{{=it.lastArriveCity}}&nbsp;&nbsp;&nbsp;{{=it.firstLeaveTime}}{{?}}</a><span class="hisRight">{{?it.price}}<span class="price">¥{{=it.price}}&nbsp;</span>起{{??}}--{{?}}</span></li>';function a7(){var bg=fish.one("#soso_17u"),be=ao.offset(),bf=be.left,bh=be.top;if(bg.hasClass("search_Width")){ap.css("left:"+(bf-5)+"px; top:"+(bh+34)+"px;margin-top:-13px;")}else{ap.css("left:"+(bf-5)+"px; top:"+(bh+34)+"px;")}ap.removeClass("none")}fish.on("click",function(bf){var bi=fish.dom(fish.getTarget(bf));do{var be=fish.one(bi);if(bi==fish.dom("body")||be.hasClass("history_line")||be.hasClass("hisClose")){ap.addClass("none");break}else{if(be.hasClass("his_search")){var bh=fish.one("iframe",ap),bg=fish.one(".hisMain",ap);a7();bh.css("position:absolute;width:"+bg.width()+"px;height:"+bg.height()+"px;border:none;z-index:-1;");break}else{if(be.hasClass("outerHisBox")){break}}}}while(bi=bi.parentNode)},document);function aY(){var bg=u.getSearchHistory(),bj,bh,bl=fish.parseTime();bj=bg.shift();bh=bg;if(bj){if(!d){bj.type=bj.type?bj.type:2;u.changeSearchType(bj.type==3?2:bj.type)}if(bj.type!=3){bj.leaveCity&&E&&E.setInputValue(bj.leaveCity);bj.arriveCity&&b&&b.setInputValue(bj.arriveCity);if(bj.leaveTime){(bj.leaveTime=bj.leaveTime<bl?bl:bj.leaveTime)&&F&&F.setInputValue(bj.leaveTime)}else{F&&F.setInputValue(F.__input.attr("holder"))}if(bj.backTime){(bj.backTime=bj.backTime<bl?bl:bj.backTime)&&c&&c.setInputValue(bj.backTime)}else{c&&c.setInputValue(c.__input.attr("holder"))}bj.cabinType&&e&&e.setSelectValue(bj.cabinType);bj.passengersType&&H&&H.setSelectValue(bj.passengersType);bj.adult&&a&&a.setSelectValue(bj.adult);bj.child&&f&&f.setSelectValue(bj.child)}}else{aW()}if(bh&&bh.length&&(ao.attr("data_history")==="show")&&fish.dom(ap)){var bi,be="",bf=l-1;for(var bk=0;bk<bf;bk++){bi=bh[bk];if(bi){be+=fish.template(aq,bi)}}fish.one("ul",ap).html(be);fish.all(".hisMain a",ap).on("click",function(br){fish.preventDefault(br);ap.addClass("none");var bm=fish.one(this),bx=bm.attr("h_leave"),bn=bm.attr("h_arrive"),bE=bm.attr("h_transit"),by=bm.attr("h_leavetime"),bp=bm.attr("h_backtime"),bD=bm.attr("h_tarnsittime"),bF=bm.attr("h_type"),bu=bm.attr("h_cabinType"),bw=bm.attr("h_passengersType"),bt=bm.attr("h_adult"),bv=bm.attr("h_child");by=by<bl?bl:by;bp=bp<bl?bl:bp;bD=bD<bl?bl:bD;if(bF==3){u.changeSearchType(bF);var bB,bA=bx.split(","),bo=bn.split(","),bz=by.split(","),bq=bA.length,bs=fish.all(".multipass .flightLine",aw);bs.addClass("none");for(var bC=0;bC<bq;bC++){fish.all(bs[bC]).removeClass("none")}bB=ah();bB.forEach(function(bH,bG){if(bG>2){aC[bG]=Y({elem:bH,onclickdele:function(){Z(bG)}})}bH.leaveCity.setInputValue(bA[bG]);bH.arriveCity.setInputValue(bo[bG]);bH.leaveTime.setInputValue(bz[bG])})}else{E.setInputValue(bx);b.setInputValue(bn);F.setInputValue(by);c.setInputValue(bp);e.setSelectValue(bu);H.setSelectValue(bw);a.setSelectValue(bt);f.setSelectValue(bv)}u.changeSearchType(bF,function(){u.submit()})});ao.removeClass("none")}else{ao.addClass("none")}}function bb(){var bn=true;switch(u.searchType){case 1:var bk=E.getInputValue(),bg=b.getInputValue(),bl=F.getInputValue();if(!E.checkNull()){E.notice&&E.notice.show();bn=false}else{if(!b.checkNull()){b.notice&&b.notice.show();bn=false}else{if(!F.checkNull()){F.cal&&F.cal.show();bn=false}}}if(bn&&(bk===bg)){E.warn("出发城市不能和到达城市相同");bn=false}if(bn&&S(bk)!==true){E.warn(S(bk));E.notice&&E.notice.show();bn=false}else{if(bn&&S(bg)!==true){b.warn(S(bg));b.notice&&b.notice.show();bn=false}}if(bn&&f&&f.checkIfDisplay()){var bi=parseInt(f.getSelectValue(),10),be=parseInt(a.getSelectValue(),10),bf=bi+be;if(bf>9){f.warn("乘机人总数不能大于9");bn=false}}if(bn){F.setInputValue(fish.parseTime(bl))}if(bn){N();ad()}break;case 2:var bk=E.getInputValue(),bg=b.getInputValue(),bl,bh;if(!E.checkNull()){E.notice&&E.notice.show();bn=false}else{if(!b.checkNull()){b.notice&&b.notice.show();bn=false}else{if(!F.checkNull()){F.cal&&F.cal.show();bn=false}else{if(!c.checkNull()){c.cal&&c.cal.show();bn=false}}}}if(bn&&(bk===bg)){E.warn("出发城市不能和到达城市相同");bn=false}if(bn&&S(bk)!==true){E.warn(S(bk));E.notice&&E.notice.show();bn=false}else{if(bn&&S(bg)!==true){b.warn(S(bg));b.notice&&b.notice.show();bn=false}}if(bn){bl=fish.parseTime(F.getInputValue());bh=fish.parseTime(c.getInputValue());F.setInputValue(bl);c.setInputValue(bh);if(bh<bl){c.warn("返回日期不能早于出发日期");bn=false}}if(bn&&f&&f.checkIfDisplay()){var bi=parseInt(f.getSelectValue(),10),be=parseInt(a.getSelectValue(),10),bf=bi+be;if(bf>9){f.warn("乘机人总数不能大于9");bn=false}}if(bn){N();ad()}break;case 3:var bm=ah(),bj=[];bm.forEach(function(bs,bp){if(bn){var bq=bs.leaveCity.getInputValue(),bo=bs.arriveCity.getInputValue(),br=bs.leaveTime.getInputValue();if(bp<2){if(!bs.leaveCity.checkNull()){bs.leaveCity.notice&&bs.leaveCity.notice.show();bn=false}else{if(!bs.arriveCity.checkNull()){bs.arriveCity.notice&&bs.arriveCity.notice.show();bn=false}else{if(!bs.leaveTime.checkNull()){bs.leaveTime.cal&&bs.leaveTime.cal.show();bn=false}else{if(bn&&(bq===bo)){bs.leaveCity.warn("出发城市不能和到达城市相同");bn=false}}}}if(bn&&S(bq)!==true){bs.leaveCity.warn(S(bq));bs.leaveCity.notice&&bs.leaveCity.notice.show();bn=false}else{if(bn&&S(bo)!==true){bs.arriveCity.warn(S(bo));bs.arriveCity.notice&&bs.arriveCity.notice.show();bn=false}}if(bn){bs.leaveTime.setInputValue(fish.parseTime(br))}br=bs.leaveTime.getInputValue();if(bn&&bm[bp-1]&&br<fish.parseTime(bm[bp-1].leaveTime.getInputValue())){bs.leaveTime.warn("第"+(bp+1)+"程日期不得早于第"+bp+"程日期");bs.leaveTime.cal&&bs.leaveTime.cal.show();bn=false}if(bn){bj.push(bs)}}else{if(S(bq)==true){if(!bs.arriveCity.checkNull()){bs.arriveCity.notice&&bs.arriveCity.notice.show();bn=false}else{if(!bs.leaveTime.checkNull()){bs.leaveTime.cal&&bs.leaveTime.cal.show();bn=false}else{if(bn&&(bq===bo)){bs.leaveCity.warn("出发城市不能和到达城市相同");bn=false}}}if(bn&&S(bo)!==true){bs.arriveCity.warn(S(bo));bs.arriveCity.notice&&bs.arriveCity.notice.show();bn=false}if(bn){bs.leaveTime.setInputValue(fish.parseTime(br))}br=bs.leaveTime.getInputValue();if(bn&&bm[bp-1]&&br<fish.parseTime(bm[bp-1].leaveTime.getInputValue())){bs.leaveTime.warn("第"+(bp+1)+"程日期不得早于第"+bp+"程日期");bs.leaveTime.cal&&bs.leaveTime.cal.show();bn=false}if(bn){bj.push(bs)}}}}});if(bn){N();ad(bj)}break}}var bc;function N(){if(bc){try{bc.abort()}catch(bf){}}if(u.onsubmit()){bc=fish.ajax({url:isearchSubmitUrl,data:G(ax),type:"jsonp",fn:be})}function be(bg){bc=null;if(bg&&bg.state===100){if(u.onsubmitsuccess(bg)!==false){window.location.href=bg.href}}}}function S(be){if(M){if(!isNaN(be)||!aN[be]){return'找不到"'+be+'"相关信息'}else{if(aN[be]&&!aN[be].code){return"该城市无机场信息"}else{return true}}}else{return true}}var W=[];var U;function ag(){fish.ajax({url:isearchDataUrl,type:"jsonp",fn:V})}function V(be){if(be){u.ajaxCityData=M=be;u.matchData=aN=af(be).citys;ar=ai(be,false);at=ai(be,true);otherConCityData=aj(be);aT=aa(otherConCityData);u.leaveNoticeData=aK={tab:["国内热门","国际热门"],data:{"国内热门":ar,"国际热门":at}};u.arriveNoticeData=Q={tab:["国际热门","国内热门"],data:{"国际热门":at,"国内热门":ar}};aK.tab=aK.tab.concat(aT);fish.lang.extend(aK.data,otherConCityData);Q.tab=Q.tab.concat(aT);fish.lang.extend(Q.data,otherConCityData);var bf=W.length;while(bf--){W[bf]&&W[bf](M,aN,aK,Q)}}}function X(be){if(be){if(M){be(M,aN,aK,Q)}else{W.push(be)}}}function ab(bg){var be=[],bf;for(bf in bg){bg[bf].name=bf;be[be.length]=bg[bf]}fish.lang.extend(be,bg);return be}function aa(bg){var be=[],bf;for(bf in bg){be[be.length]=bf}fish.lang.extend(be,bg);return be}var M,aN,ar,at,aV,aK,Q,aT;function af(bf){var be,bg;bf.citys=ab(bf.citys);be=bf.citys;bg=be.length;while(bg--){be[bg].match=aa(be[bg].match);be[bg].match.push(be[bg].name);be[bg].match[be[bg].name]=255;be[bg].match.push(be[bg].cnCtryName);be[bg].match.push(be[bg].enCtryName);be[bg].match.push(be[bg].enname);be[bg].match.push(be[bg].spelling)}return bf}function ai(bg,bh){var be=[],bj=[],bf=bg.citys,bi=bf.length;while(bi--){if(bf[bi].hot>0&&(bh?(bf[bi].fittype.charAt(1)==1):(bf[bi].fittype.charAt(0)==1))){be[be.length]={name:bf[bi].name,hot:bf[bi].hot}}}be.sort(function(bk,bl){return bl.hot-bk.hot});if(be.length){for(var bi=0;bi<be.length&&bi<25;bi++){bj.push(be[bi].name)}}at=bj;return bj}function aj(bg){var bj={},bi={},bf=bg.citys,bh,be;bh=bf.length;while(bh--){if(bf[bh].fittype.charAt(1)==1){be=bf[bh].area;if(!bi[be]){bi[be]=[]}bi[be].push(bf[bh])}}for(be in bi){bi[be].sort(function(bk,bl){return bl.hot-bk.hot})}for(be in bi){bi[be].forEach(function(bk){if(!bj[be]){bj[be]=[]}bj[be].push(bk.name)})}return bj}function aQ(bf,bo){var bg=[],bm=[],bi,be,bh,bj,bk,bn=bf.tab,bl=ab(bf.data);bh=0;while(bi=bn[bh++]){bm.push('<li class="mNotice-mTab-item '+(bh===1?"current":"")+'">'+bi+"</li>")}bo=bo.replace("{tab}",bm.join(""));bj=0;while(bi=bl[bj++]){bk=0;be=bi;bg.push('<div class="mNotice-mTab-content clearfix '+(bj==1?"":"none")+'">');while(bi=be[bk++]){bg.push('<span class="mNotice-normal mNotice-fixWidth" title="'+bi+'">'+bi+"</span>")}bg.push("</div>")}return bo.replace("{contents}",bg.join(""))}var aR='<div class="mNotice-mTab"><h4 class="mNotice-mTab-head">热门城市<span class="mNotice-mTab-head-remark">（可直接选择城市或输入城市中文/拼音/英文）</span><span class="mNotice-close white"></span></h4><div class="mNotice-mTab-wrap"><ul class="mNotice-mTab-tab-tray clearfix">{tab}</ul>{contents}</div></div>';function aU(be,bf,bg){be._keyPriority=be.match[bf];be._matchPriority=bg;if(be.code){be._typePriority=2}else{be._typePriority=1}}function a8(be,bf){if((be._typePriority>bf._typePriority)||(be._typePriority===bf._typePriority&&be._matchPriority<bf._matchPriority)||(be._typePriority===bf._typePriority&&be._matchPriority===bf._matchPriority&&be.priority>bf.priority)||(be._typePriority===bf._typePriority&&be.priority===bf.priority&&be._matchPriority===bf._matchPriority&&be._keyPriority>bf._keyPriority)||(be._typePriority===bf._typePriority&&be.priority===bf.priority&&be._matchPriority===bf._matchPriority&&be._keyPriority==bf._keyPriority)&&be.hot>bf.hot){return -1}else{return 1}}function aJ(be){var bf;if(!!be.code){bf="<div class='match_div'><span class='match_right'>"+be.enname+"</span><span class='match_left'>"+be.name+"</span></div>"}return bf}u.noticeDisplayFn=aQ;u.noticeTemplate=aR;u.preSortFn=aU;u.sortFn=a8;u.itemPrintFn=aJ;var aS=false,aO=false,O=fish.all("#iflight_mult .flightLine");fish.dom(p)&&(e=j({elem:p,related:D}));fish.dom(B)&&(H=j({elem:B,related:D}));fish.dom(m)&&(a=j({elem:m,related:D}));fish.dom(r)&&(f=j({elem:r,related:D}));function aE(be){if(!aS){aF=Y({elem:aG,oncompleteinit:be,leaveCityQuery:x,arriveCityQuery:n,leaveTimeQuery:y,backTimeQuery:o});E=aF.leaveCity;b=aF.arriveCity;F=aF.leaveTime;c=aF.backTime;aS=true;be&&be()}else{be&&be()}}function aD(be){if(!aO){O.each(function(bf,bg){if(bg>2){return false}else{aC[bg]=Y({elem:bf,onclickdele:function(){Z(bg)}})}});aO=true;be&&be()}else{be&&be()}}function ak(){var bf=[],be;O.each(function(bh,bg){if(fish.one(bh).getCss("display")!=="none"&&aC[bg]){be=[aC[bg].leaveCity.getInputValue(),aC[bg].arriveCity.getInputValue(),aC[bg].leaveTime.getInputValue()];bf.push(be)}});return bf}function a4(be){var bf;O.each(function(bh,bg){if(fish.one(bh).getCss("display")!=="none"&&aC[bg]){bf=be.shift();if(bf){aC[bg].leaveCity.setInputValue(bf[0]);aC[bg].arriveCity.setInputValue(bf[1]);aC[bg].leaveTime.setInputValue(bf[2])}else{aC[bg].clear()}}})}function a3(){var be=0;O.each(function(bf){if(fish.one(bf).getCss("display")!=="none"){be++;fish.all(".line_num em",bf).html(be)}});if(be!==6){a5()}return be}function ah(){var be=[];O.each(function(bg,bf){if(fish.one(bg).getCss("display")!=="none"){aC[bf]&&be.push(aC[bf])}});return be}function T(){var be=0;O.each(function(bf){if(fish.one(bf).getCss("display")!=="none"){be++}});return be}function Z(be){var bf=T(),bg=ak();if(aC[bf-1]){aC[bf-1].hide()}a3();bg.splice(be,1);a4(bg)}function K(){var bf,be,bg=ak();O.each(function(bi,bh){if(fish.one(bi).getCss("display")==="none"){bf=bh;return false}});if(bf){if(!aC[bf]){aC[bf]=Y({elem:O[bf],onclickdele:function(){Z(bf)}})}aC[bf].show()}be=a3();if(be===6){al()}a4(bg)}function al(){J.css("display:none")}function a5(){J.css("display:block")}function Y(bg){var be={leaveCityQuery:".leavePort",arriveCityQuery:".arrivePort",leaveTimeQuery:".leaveTime",backTimeQuery:".backTime",deleBtnQuery:".dele_btn",oncompleteinit:null,onclickdele:null,elem:null};var bf=fish.lang.proto(aL);fish.lang.extend(be,bg);fish.lang.extend(bf,be);bf.__elem=fish.all(bf.elem);bf.__leaveCity=fish.all(bf.leaveCityQuery,bf.__elem);bf.__arriveCity=fish.all(bf.arriveCityQuery,bf.__elem);bf.__leaveTime=fish.all(bf.leaveTimeQuery,bf.__elem);bf.__backTime=fish.all(bf.backTimeQuery,bf.__elem);bf.__deleBtn=fish.all(bf.deleBtnQuery,bf.__elem);bf.leaveCity=j({elem:bf.__leaveCity,related:D});bf.arriveCity=j({elem:bf.__arriveCity,related:D});bf.leaveTime=j({elem:bf.__leaveTime,related:D});bf.backTime=j({elem:bf.__backTime,related:D});bf.__deleBtn.on("click",function(){bf.clear();bf.onclickdele&&bf.onclickdele()});fish.require("mNotice mCal autoComplete",function(){X(function(bi,bk,bj,bh){bf.leaveCity.notice=bf.leaveCity.__input.mNotice({localData:bj,isClick:true,isHover:true,template:aR,mode:"mTab",display:aQ,clickCallback:function(){bf.leaveCity.setFullStyle()}});bf.arriveCity.notice=bf.arriveCity.__input.mNotice({localData:bh,isClick:true,isHover:true,template:aR,mode:"mTab",display:aQ,clickCallback:function(){bf.arriveCity.setFullStyle()}});bf.leaveCity.autoComplete=bf.leaveCity.__input.autoComplete({title:"输入中文/拼音/英文/或↑↓键选择",placeholder:"城市名",localData:bk,highlight:true,keepListOnNoResult:true,width:220,max:10,preSortFn:aU,sortFn:a8,itemValueFn:function(bl){bf.leaveCity.setFullStyle();return bl.name},itemPrintFn:aJ,itemEnableFn:function(){return true},width:240});bf.arriveCity.autoComplete=bf.arriveCity.__input.autoComplete({title:"输入中文/拼音/英文/或↑↓键选择",placeholder:"城市名",localData:bk,highlight:true,keepListOnNoResult:true,width:220,max:10,preSortFn:aU,sortFn:a8,itemValueFn:function(bl){bf.arriveCity.setFullStyle();return bl.name},itemPrintFn:aJ,itemEnableFn:function(){return true},width:240})});if(bf.leaveTime){bf.leaveTime.cal=bf.leaveTime.__input.mCal({fn:function(bh){if(u.searchType=="2"){bf.backTime.__input.val(fish.parseTime(bh,{days:1}));bf.backTime.cal.startTime=bh;bf.backTime.cal.show();bf.backTime.cal.setNow(fish.parseTime(fish.one(bf.backTime.__input).val()));bf.backTime.cal.show(false,false)}bf.leaveTime.setFullStyle()}})}if(bf.backTime){bf.backTime.cal=bf.backTime.__input.mCal({startTime:fish.parseTime(bf.leaveTime.__input.val()),fn:function(){bf.backTime.setFullStyle()}})}bf.oncompleteinit&&bf.oncompleteinit(bf)});return bf}var aL={showBackTime:function(){if(this.backTime){this.backTime.show()}},hideBackTime:function(){if(this.backTime){this.backTime.hide()}},hide:function(){this.__elem.css("display:none")},show:function(){this.__elem.css("display:")},clear:function(){this.leaveCity&&this.leaveCity.clear();this.arriveCity&&this.arriveCity.clear();this.leaveTime&&this.leaveTime.clear();this.backTime&&this.backTime.clear()}};J.on("click",K);fish.one(D).on("click",bb);fish.ready(function(){if(!fish.browser("ms",6)){aY()}ag()});fish.loaded(function(){if(fish.browser("ms",6)){aY()}});u.oncitydataready=X;u.submit=bb;return u}fish.extend({iFlightSearch:function(J){x=J.ileaveCityElem;n=J.iarriveCityElem;y=J.ileaveTimeElem;o=J.ibackTimeElem;v=J.ihistoryElem;w=J.ihistorySearchElem;p=J.icabinTypeElem;B=J.ipassengersTypeElem;m=J.iadultElem;r=J.ichildElem;q=J.ichangeCityElem;t=J.icontentElem;isearchSubmitUrl=J.isearchSubmitUrl;isearchDataUrl=J.isearchDataUrl;A=J.ioneWayElem;C=J.ireturnWayElem;s=J.iconnectWayElem;D=J.isubmitElem;return z()}})})();