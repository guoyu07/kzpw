/*from tccdn minify at 2014-6-5 12:43:51,file：/cn/new_ui/airplane/home/index.0.2.3.fwd.js?v=2013101402*/
(function(){fish.on("click",n,"#lefLastInfo");fish.on("click",o,"#lefNextInfo");var i=3001;var c=fish.all("#commentOnFlight div.comment_02");function n(){i--;c.css("display:none");c[i%3].style.display="block";l()}function o(){i++;c.css("display:none");c[i%3].style.display="block";l()}function l(){fish.all("#comment_num").html((i%3)+1)}n();function e(s){var r=fish.one("#flightMarketDom").val(),q=fish.one("#flightMarketFlash");r=r.replace(/\{xmlURL\}/g,s);q.html(r)}window.createFlash=e;function h(t){var r=document.createElement("div"),q=[];fish.all(r).html(t);for(var s=0;s<r.childNodes.length;s++){if(r.childNodes[s].nodeType===1){q.push(r.childNodes[s])}}r=null;return fish.all(q)}function f(t){var q=fish.all(t.elem);var r={template:'<div class="search_warn none" style="position:absolute"><span class="arrow"></span><span class="info">{{=it.tips}}</span></div>',related:"",holder:fish.all("input",q).attr("holder"),nullTips:fish.all("input",q).attr("nulltips"),elem:null};var s=fish.lang.proto(searchInputFn);fish.lang.extend(r,t);fish.lang.extend(s,r);s.__input=fish.all("input",fish.dom(s.elem));s.__elem=q;s.__input.hover(function(){s.__input.addClass("focus")},function(){if(s.__input.attr("focusnow")!=="true"){s.__input.removeClass("focus")}});s.__input.on("focus",function(){this.setAttribute("focusnow","true");s.__input.addClass("focus");s.hideWarn()}).on("blur",function(){this.setAttribute("focusnow","false");s.__input.removeClass("focus");this.value=fish.trim(this.value);if(this.value===""){this.value=s.holder}}).on("click",function(){this.value=fish.trim(this.value);this.select()}).on("keyup",function(v){var u=fish.getEvent(v);if(u.keyCode){code=u.keyCode}else{if(u.which){code=u.which}}if(code==13){fish.preventDefault(u)}});fish.one("body").on("resize",function(){s.resetPosition()});return s}searchInputFn={getInputTopLeft:function(){return this.__input.offset()},getInputWidth:function(){return this.__input.width()},getInputHeight:function(){return this.__input.height()},getInputValue:function(){return this.__input.val()},setInputValue:function(q){this.__input.val(q)},hide:function(){this.__elem.css("display:none")},show:function(){this.__elem.css("display:block")},warn:function(q){if(!this.warnElem){this.warnElem=h(fish.template(this.template,{tips:q}));fish.one("body").html("top",this.warnElem);this.warnElem.effect({elem:fish.all(this.related),interShow:false})}else{fish.one(".info",this.warnElem).html(q)}this.warnElem.css("display:block");this.resetPosition()},hideWarn:function(){this.warnElem&&this.warnElem.css("display:none")},checkNull:function(){var q=this.getInputValue();q=fish.trim(q);this.setInputValue(q);if(q===""||q===this.holder){this.warn(this.nullTips);return false}else{this.hideWarn();return true}},resetPosition:function(){if(this.warnElem){var r=this.getInputTopLeft(),u=this.getInputWidth(),q=this.getInputHeight(),s=r.left+u+45,t=r.top+parseInt(q/2,10)-13;this.warnElem.css("left:"+s+"px;top:"+t+"px")}}};var a,j;function d(q){if(a){if(!j[q]){return'找不到"'+q+'"相关信息'}else{if(j[q]&&!j[q].code){return"该城市无机场信息"}else{return true}}}else{return true}}var b=fish.all("#viewTrend .choose_city");var k=f({elem:b[1],related:"#viewTrend .trend_link"});var g=f({elem:b[0],related:"#viewTrend .trend_link"});function m(){var r=fish.one("#orgPortPrice").val(),q=fish.one("#desPortPrice").val(),s=true;if(!g.checkNull()){g.notice&&g.notice.show();s=false}else{if(!k.checkNull()){k.notice&&k.notice.show();s=false}}if(s&&(r===q)){g.warn("出发城市不能和到达城市相同");s=false}if(s&&d(q)!==true){g.warn(d(q));g.notice&&g.notice.show();s=false}else{if(s&&d(r)!==true){k.warn(d(r));k.notice&&k.notice.show();s=false}}if(s){fish.ajax({url:_flight("priceInformationUrl"),type:"jsonp",data:"orgPort="+encodeURIComponent(r)+"&desPort="+encodeURIComponent(q)+"&refid="+getRefid(),fn:function(t){if(t&&t.state===100){var u="xmlURL="+t.url;e(u)}}})}}fish.on("click",m,"#viewTrend a.trend_link");fish.on("click",function(s){var w=fish.getTarget(s);do{className=w.className;if(className&&className.indexOf("salelist")>-1){return}if(className&&className.indexOf("tips")>-1){var v=w.getAttribute("_href");if(v){window.open(v)}}else{if(className&&className.indexOf("special_list")>-1){var q=w.getAttribute("cityId");var u=fish.all("#specialTicket div.salelist");for(var t=0;t<u.length;t++){u[t].className="none salelist"}var r=fish.one("#tab_list"+q)[0];r.className="show salelist";if(r.innerHTML==""&&r.innerHTML!='<div class="sale_loading">正在加载中...</div>'){r.innerHTML='<div class="sale_loading">正在加载中...</div>';fish.ajax({url:_flight("specialpriceUrl"),data:"cityid="+q,fn:function(x){if(x){r.innerHTML=x}}})}}}}while(w=w.parentNode)},"#specialTicket");fish.on("click",function(r){var s=fish.all("#tab_top span");var q=fish.getTarget(r);for(var t=0;t<s.length;t++){if(s[t]==q||s[t].parentNode==q){s[t].parentNode.className="btnSee special_list"}else{s[t].parentNode.className="btnNone special_list"}}},"#tab_top");function p(s){var x=1,y="",q="",B=0,v=fish.one("#flightTimeMo").val();for(var w=0;w<s.length;w++){var t=v,z;t=t.replace("{flightNo}",s[w].flightNo);t=t.replace("{onTimePerformance}",s[w].onTimePerformance);t=t.replace("{startPort}",s[w].startPort);t=t.replace("{StartPortTerminal}",s[w].StartPortTerminal);t=t.replace("{endPort}",s[w].endPort);t=t.replace("{EndPortTerminal}",s[w].EndPortTerminal);t=t.replace("{planTime}",s[w].planTime);if(s[w].actualOffTime[0]){t=t.replace("{actualOffTime}",s[w].actualOffTime[0])}else{t=t.replace("{actualOffTime}","")}if(s[w].actualArriveTime[0]){t=t.replace("{actualArriveTime}",s[w].actualArriveTime[0])}else{t=t.replace("{actualArriveTime}","")}t=t.replace("{state}",s[w].state);z=parseInt(s[w].onTimePerformance,10);if(z>=90){t=t.replace("{onTimeClass}","color_F60")}else{t=t.replace("{onTimeClass}","")}if(s[w].actualOffTime[1]=="0"){t=t.replace("{offTimeClass}","cancel")}else{t=t.replace("{offTimeClass}","")}if(s[w].actualArriveTime[1]=="0"){t=t.replace("{arriveTimeClass}","cancel")}else{t=t.replace("{arriveTimeClass}","")}if(s[w].state=="到达"){t=t.replace("{stateClass}","arrived")}else{if(s[w].state=="待起飞"){t=t.replace("{stateClass}","takeoff")}else{if(s[w].state=="取消"){t=t.replace("{stateClass}","cancel")}}}y=y+t;if(x==5||w==(s.length-1)){var r='<table cellpadding="0" cellspacing="0" class="schedule_info"><tbody>'+y+"</tbody></table>";y="";q=q+r;x=0;B++}x++}fish.one("#flightTimeMain").html('<div class="flightTimeSmi">'+q+"</div>");var A="";for(var u=0;u<B;u++){A=A+"<li _num="+u+"></li>"}fish.one("#flightTimeBox").html("bottom","<ul class='point_cut'>"+A+"</ul>");fish.one("#flightTimeMain .flightInfo_box").removeClass("none");fish.require("mSlider",function(){var C=fish.one("#flightTimeBox").mSlider({showNav:"sustom",content:".schedule_info",canvas:".flightTimeSmi",autoScroll:false,nav:".point_cut li",direction:"y"})})}window.writeFlightTime=p;fish.ready(function(){fish.require("anim mSlider")});fish.loaded(function(){m();function r(E){src=E.getAttribute("nsrc");alt=E.getAttribute("nalt");return"<img src='"+src+"' alt='"+(alt?alt:"")+"' />"}var B=fish.all("#comSlide_main a.linka");fish.all("#slide_main_top").mSlider({moveTime:4000,content:"#comSlide_main a",canvas:"#comSlide_main",aniType:"fade",beforeNextFn:function(){B.each(function(E,F){if(!B.imgLoaded){var G=fish.one("img",E);if(F===B.length-1){B.imgLoaded=true}if(!G.length){E.innerHTML=r(E);return false}}})}});fish.one("#slide_main_top").hover(function(){B.each(function(E,F){if(!B.imgLoaded){var G=fish.one("img",E);if(F===B.length-1){B.imgLoaded=true}if(!G.length){E.innerHTML=r(E)}}})},function(){return});var D;fish.one("#group_center_main").mSlider({autoScroll:false,showNav:false,scrollNum:1,circle:true,arrows:true,content:"#rgt_tgList li",canvas:"#rgt_tgList",prevBtn:"#tg_last",nextBtn:"#tg_next",beforePrevFn:function(E){!q.invoked&&q()},beforeNextFn:function(E){!q.invoked&&q()}});function q(){fish.all("#rgt_tgList .linka").each(function(E,F){(F>1)&&(E.innerHTML="<img alt='"+E.getAttribute("nalt")+"' src='"+E.getAttribute("nsrc")+"'/><span class='maskBox'></span>")});q.invoked=true}fish.one("#airlinesList").mSlider({autoScroll:false,circle:true,arrows:true,content:"#airlinesList li",canvas:"#airlinesList ul",scrollNum:1,showNav:false,prevBtn:"#btn_l",nextBtn:"#btn_r",moveTime:5000});fish.one("#selectedTC").mSlider({autoScroll:true,showNav:false,scrollNum:1,circle:true,arrows:true,content:"#selectedTC li",canvas:"#selectedTC ul",prevBtn:"#selected_right",nextBtn:"#selected_left",moveTime:3000});function w(F,T){var H=[],S=[],R=F.tab,G=F.data[F.tab[0]],E=F.data,J,N,M,Q,I,K,L,P,O;K=0;while(J=R[K++]){S.push('<li class="mNotice-mTab-item '+(K===1?"current":"")+'">'+J+"</li>")}T=T.replace("{tab}",S.join(""));I=0;H.push('<div class="mNotice-mTab-content clearfix">');while(J=G[I++]){H.push('<span class="mNotice-normal mNotice-fixWidth" title="'+J+'">'+J+"</span>")}H.push("</div>");L=1;while(J=R[L++]){M=J.split("");H.push('<div class="mNotice-mTab-content none">');P=0;while(Q=M[P++]){H.push('<dl class="clearfix mNotice-block"><dt class="mNotice-title">'+Q+'</dt><dd class="mNotice-def">');O=0;while(N=E[Q][O++]){H.push('<span class="mNotice-normal mNotice-fixWidth" title="'+N+'">'+N+"</span>")}H.push("</dd></dl>")}H.push("</div>")}return T.replace("{contents}",H.join(""))}var x='<div class="mNotice-mTab"><h4 class="mNotice-mTab-head">热门城市<span class="mNotice-mTab-head-remark">（可直接选择城市或输入城市中文/拼音）</span><span class="mNotice-close white"></span></h4><div class="mNotice-mTab-wrap"><ul class="mNotice-mTab-tab-tray clearfix">{tab}</ul>{contents}</div></div>';function z(H,M){var J=H.length,K,L,E,F,G;while(J--){if(H[J]){if(!H[J].code&&(L=H[J].near)){for(K in L){if(this.localData[K]){H.splice(J+1,0,{name:K,distance:L[K]})}}}if(F=H[J].ReverseGuide){for(var I=0;I<F.length;I++){E=this.localData[F[I]];if(E){G=F[I];H.forEach(function(O,N){if(O&&(O.name===G)){H[N]=null}});H.splice(J+1,0,{name:E.name,quanpin:E.quanpin,reverse:true})}}H.splice(J+1,0,{tips:M})}}}J=H.length;while(J--){if(!H[J]){H.splice(J,1)}}}function y(E,F,G){E._keyPriority=E.match[F];E._matchPriority=G;if(E.code){E._typePriority=3}else{if(E.near){E._typePriority=2}else{E._typePriority=1}}}function C(E,F){if((E._typePriority>F._typePriority)||(E._typePriority===F._typePriority&&E._matchPriority<F._matchPriority)||(E._typePriority===F._typePriority&&E._matchPriority===F._matchPriority&&E.priority>F.priority)||(E._typePriority===F._typePriority&&E.priority===F.priority&&E._matchPriority===F._matchPriority&&E._keyPriority>F._keyPriority)){return -1}else{return 1}}function v(E){return E.name}function u(E){var F;if(E.reverse){F="<div class='match_div match_gray_bg'><span class='match_right'>"+E.quanpin+"</span><span class='match_icon match_left'>"+E.name+"</span></div>"}else{if(E.distance){F="<div class='match_div match_gray_bg'><span class='match_icon'>邻近机场："+E.name+"-"+E.distance+"公里</span></div>"}else{if(E.tips){F="<div class='match_div match_gray_bg'><span class='match_tips match_gray'>"+E.tips+"</span></div>"}else{if(!!E.code){F="<div class='match_div'><span class='match_right'>"+E.quanpin+"</span><span class='match_left'>"+E.name+"</span></div>"}else{if(!E.code&&E.near){F="<div class='match_div match_gray_bg'><span class='match_right gray'>"+E.quanpin+"</span><span class='match_left match_gray '>"+E.name+" - 无机场</span></div>"}}}}}return F}function s(E){return E.code||E.distance||E.reverse}function t(E){return E.code&&!E._reverse}fish.all("#viewTrend .choose_city").on("click",function(){var E=this;setTimeout(function(){fish.dom("input",E).focus()})});b.hover(function(){this.style.borderColor="#76BBFF"},function(){if(this.getAttribute("_focus")=="false"){this.style.borderColor="#CCCCCC"}});fish.all("#viewTrend .choose_city input").on("blur",function(){this.parentNode.style.borderColor="#CCCCCC";this.parentNode.setAttribute("_focus","false")});fish.all("#viewTrend .choose_city input").on("focus",function(){this.parentNode.style.borderColor="#76BBFF";this.parentNode.setAttribute("_focus","true")});var A=setInterval(function(){if(window.flightSearchBox&&fish.dom("#orgPortPrice")&&fish.dom("#desPortPrice")){window.flightSearchBox.oncitydataready(function(E,F,G){a=E;j=F;setTimeout(function(){fish.one("#orgPortPrice").mNotice({localData:G,isClick:true,isHover:true,template:x,mode:"mTab",display:w});fish.one("#orgPortPrice").autoComplete({title:"输入中文/拼音/↑↓键选择",placeholder:"城市名",localData:F,highlight:true,keepListOnNoResult:true,width:220,max:10,processPrintDataFn:function(H){z.call(this,H,"更精确出发地")},preSortFn:y,sortFn:C,itemValueFn:v,itemPrintFn:u,itemHighlightFn:t,itemEnableFn:s})},0);setTimeout(function(){fish.one("#desPortPrice").mNotice({localData:G,isClick:true,isHover:true,template:x,mode:"mTab",display:w});fish.one("#desPortPrice").autoComplete({title:"输入中文/拼音/↑↓键选择",placeholder:"城市名",localData:F,highlight:true,keepListOnNoResult:true,width:220,max:10,processPrintDataFn:function(H){z.call(this,H,"更精确到达地")},preSortFn:y,sortFn:C,itemValueFn:v,itemPrintFn:u,itemHighlightFn:t,itemEnableFn:s})},0)});clearInterval(A)}},1000);fish.ajax({url:_flight("flightNoRealTimeUrl"),type:"jsonp",fn:function(E){if(E.state=="100"&&E.flightNoList){p(E.flightNoList)}}});fish.on("click",function(){fish.one("#flightMarketFlash").addClass("none");fish.mPop({content:fish.one("#strategyBox"),afterClose:function(){fish.one("#flightMarketFlash").removeClass("none")}})},"#flightStrategy");fish.on("click",function(){fish.mPop.close();fish.one("#flightMarketFlash").removeClass("none")},"#mPopBox .link_close")})})();