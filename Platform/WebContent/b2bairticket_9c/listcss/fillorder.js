var FillOrderClient=Elong.Page.FillOrderClient=Class.create();Object.extend(FillOrderClient.prototype,{name:"FillOrderClient",initialize:function(){this.initializeDOM();this.initializeServerData();this.initializeEvent();this.initInputData();this.refreshAmount();this.render();},initializeDOM:function(){this.dvtop_prompt=$("#top_prompt");this.dvdelivery=$("#delivery");this.dvflightlist=$("#flightlist");this.dvxiaofeiquan=$("#xiaofeiquan");this.dvpassenger=$("#passenger_info");this.contentEnd=$("#m_contentend");this.divpassengerhistory=$("#passenger_history");this.dvContactInfoRegion=$("#contact_info");this.btnSaveOrder=$("#btnSaveOrder");this.inpCollection=$("#passenger_info input[type='text']");this.topStep=$("ul[class='header_step']");this.dvUpgrade=$("#upgrade");this.loginButton=$("#btnLoginFore");this.loginInfo=$("#loginOper");this.myLogin=$("a[method='login']");this.userName=this.loginInfo.find("input[method='user']");this.realpass=this.loginInfo.find("input[method='realpass']");this.txtvcode=this.loginInfo.find("input[method='txtvcode']");$(document).click(function(b){var a=Event.element(b);if(a.attr("method")!="login"){this.loginInfo.hide();}}.bind(this));this.preprice=$("span[method='ticket']");},initializeServerData:function(){this.language=FillOrderController.Language;this.resource=FillOrderController.Resources;this.orderData=FillOrderController.OrderModel;this.passengerIndex=100;this.pageUrl=FillOrderController.CurrentPageUrl;this.ssoLoginUrl=FillOrderController.SsoLoginUrl;this.childRuleRate=FillOrderController.ChildRuleRate;this.infantRuleRate=FillOrderController.InfantRuleRate;this.cacheKey=FillOrderController.OrderModel.CacheKey;this.formElement=this.getFormElement(this.dvpassenger,this.dvContactInfoRegion,this.dvdelivery);var a=new StringBuilder();if($("#EmergentInfoMsg").val()!=""){a.append($("#EmergentInfoMsg").val());}if($("#KeatSeatMsg").val()!=""){a.append($("#KeatSeatMsg").val());}if($("#oneOurFlightMsg").val()!=""){a.append($("#oneOurFlightMsg").val());}if(a.toString()!=""){this.dvtop_prompt.html(a.toString());this.dvtop_prompt.show();}if(!this.orderData.IsCheckSeatOver&&this.orderData.RequestInfo.FlightType.toLowerCase()=="oneway"){FillOrderController.CheckSeat(this.cacheKey,function(b){if(b.success){if(b.value!=null){FillOrderController.MinTicketCount=b.value;this.orderData.IsCheckSeatOver=true;}}}.bind(this));}this.displayContact();},initInputData:function(){this.dvpassenger.find("select").each(function(){$(this).change();});this.dvdelivery.find("input[method='DeliveryType']:checked").click();this.IsShwoAllHistory=true;},initializeEvent:function(){this.dvdelivery.bind("click",this.onClickDelivery.bindAsEventListener(this));this.dvdelivery.bind("keyup",this.onKeyupdvDeliveryRegion.bindAsEventListener(this));this.dvdelivery.bind("mouseover",this.onMouseOverdvDeliveryRegion.bindAsEventListener(this));this.dvdelivery.bind("mouseout",this.onMouseOutdvDeliveryRegion.bindAsEventListener(this));this.bindChangeEvent(this.dvdelivery,this.onChangedvDeliveryRegion.bindAsEventListener(this));this.dvflightlist.bind("mouseover",this.onMouseoverFlightList.bindAsEventListener(this));this.dvflightlist.bind("mouseout",this.onMouseoutFlightList.bindAsEventListener(this));this.dvUpgrade.bind("mouseover",this.onMouseoverFlightList.bindAsEventListener(this));this.dvUpgrade.bind("mouseout",this.onMouseoutFlightList.bindAsEventListener(this));this.dvUpgrade.bind("click",this.onClickUpgrade.bindAsEventListener(this));this.dvxiaofeiquan.bind("click",this.onClickXiaofeiquan.bindAsEventListener(this));this.divpassengerhistory.bind("click",this.onClickPassengerHistory.bindAsEventListener(this));this.dvpassenger.bind("click",this.onClickPassenger.bindAsEventListener(this));this.dvpassenger.bind("keypress",this.onKeypressdvPassengerInfoRegion.bindAsEventListener(this));this.dvpassenger.bind("mouseover",this.onMouseOverdvPassengerInfoRegion.bindAsEventListener(this));this.dvpassenger.bind("mouseout",this.onMouseOutdvPassengerInfoRegion.bindAsEventListener(this));this.bindChangeEvent(this.dvpassenger,this.onChangePassenger.bindAsEventListener(this));this.inpCollection.bind("blur",this.onBlurinpinpCollection.bindAsEventListener(this));this.inpCollection.bind("focus",this.onFocusinpinpCollection.bindAsEventListener(this));this.dvdelivery.find("input[type=text]").bind("blur",this.onBlurinpinpCollection.bindAsEventListener(this));this.dvContactInfoRegion.find("input[type=text]").bind("blur",this.onBlurinpinpCollection.bindAsEventListener(this));this.btnSaveOrder.bind("click",this.onClickbtnSaveOrder.bindAsEventListener(this));$("#couponTip").find("#link_login").bind("click",this.onClickLogin.bindAsEventListener(this));$("#couponTip").bind("mouseover",this.onMouseoverFlightList.bindAsEventListener(this));this.loginInfo.bind("click",this.onClickLoginInfo.bindAsEventListener(this));this.loginButton.bind("click",this.onClickLoginFore.bindAsEventListener(this));this.realpass.bind("keydown",this.onKeyDownLogin.bindAsEventListener(this));},render:function(){if(this.language=="CN"&&(FillOrderController.IsNeedOpenAPIBind||Globals.cookie("SsoPopup")=="1")&&!FillOrderController.OrderModel.IsLogOn){var b=this.pageUrl;var c=String.format(this.ssoLoginUrl,b);var a='<iframe id="iframeQQ" frameborder="0"  src="'+c+'" width="560px" height="420px"></iframe>';var d=new Dialog({title:"激活提示",htmlContent:a,width:585,initEvent:function(e){}.bind(this)});d.show();return;}else{if(!FillOrderController.OrderModel.IsLogOn&&FillOrderController.ShowLogin){$loginDialog(this.language,true,true,this.pageUrl,"",function(e){switch(e){case 1:location.reload();break;case 2:break;}});}}this.topStep.find("li[id='lt0']:first").attr("class","action");},bindChangeEvent:function(b,a){b.find("select").bind("change",a);b.find("input").bind("change",a);},onClickUpgrade:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"select":if(element.attr("checked")){$("#pButton").show();}else{$("#pButton").hide();}break;case"upgrade":var sel=this.dvUpgrade.find("input[type='checkbox']:checked");if(sel.length>0){element.addClass("com_btnout");element.disabled=true;var flightnum=sel.attr("flightnum");var flightclassnum=sel.attr("flightclassnum");var fareid=sel.attr("fareid");var departtime=sel.attr("departtime");var price=sel.attr("price");var channel=sel.attr("channel");var promotionid=sel.attr("promotionid");this.getOrderData();FillOrderController.Upgrade(flightnum,flightclassnum,fareid,channel,promotionid,this.orderData,function(ret){if(ret.success){var nexturl="";var url=new Template(FillOrderController.UrlConfig.Flight_FillOrder.replace(/{/g,"#{"));var orderurl=url.eval({language:FillOrderController.Language.toLowerCase(),cachekey:ret.value});nexturl=orderurl;if(window.location.host=="big5.elong.com"){var ht="ht";nexturl=ht+"tp://flight.elong.com"+nexturl;}element.removeClass("com_btnout");element.disabled=false;window.location=nexturl+"?upgrade=1";}else{}}.bind(this),false,"POST");}else{}break;}},onClickLoginFore:function(a){this.loginInfo.show();},onKeyDownLogin:function(a){if(a.keyCode==13){this.RealLogin();}},RealLogin:function(){var e=this.userName;var d=this.realpass;var f=$("#loginOper").find("li[method='vcode']");var a=$("span[method='login']");var b=this.language=="CN"?false:true;var c=$("#inputRememberMe").attr("checked")?true:false;if(!validator.valid(e.val().trim(),"notEmpty & loginName")){$("#showError").html("<span></span>"+this.resource.Js_LoginName).show();this.userName.addClass("error");return;}if(!validator.valid(d.val(),"notEmpty")){$("#showError").html("<span></span>"+this.resource.Js_LoginPWD).show();this.realpass.addClass("error");return;}$("#showError").hide();this.userName.removeClass("error");this.realpass.removeClass("error");a.hide();$("span[method='wait']").show();Elong.login(encodeURIComponent(e.val().trim()),d.val(),f.find("input").val(),function(i){a.show();$("span[method='wait']").hide();if(i.MemberLoginCode!=1&&i.IsShowVCode){$("#showVCode").show();$("#loginDiv").find("li[method='vcode']").show();$("#loginDiv").find("input[method='txtvcode']").val("");var j=String.format(FillOrderController.ValidateUrl,new Date().getTime());$("#loginOper").find("img").attr("src",j);}switch(i.MemberLoginCode){case 1:var g=this.pageUrl;if(g.indexOf("#")>0){var h=g.substring(0,g.indexOf("#"));window.location.href=h;}window.location.href=g;return;case 100:$("#showError").html("<span></span>"+this.resource.Js_LoginNameNotExist).show();this.userName.addClass("error").focus();break;case 101:$("#showError").html("<span></span>"+this.resource.Js_LoginPWDError).show();break;case 102:break;case 103:$("#showError").html("<span></span>"+this.resource.Js_LoginNameFreezing).show();break;case 104:$("#showError").html("<span></span>"+this.resource.Js_LoginVCodeError).show();$("#loginOper").find("input[method='txtvcode']").addClass("error");$("#loginOper").find("li[method='vcode']").show();break;case 105:alert(i.MemberCardList);break;default:$("#showError").html("<span></span>"+this.resource.Js_LoginOtherError).show();break;}}.bind(this),null,b,c);},onClickLoginInfo:function(d){d.stopPropagation();var c=Event.element(d);var f=c.attr("method");switch(f){case"imgCode":var e=this.loginInfo.find("img[method='imgCode']");e.attr("src",e.attr("src")+"?"+Math.random());break;case"closeLoginWindow":this.closeLoginDailog();break;case"forgotpass":var h=(this.userName.val()==this.userName.attr("default"))?"":this.userName.val().trim();var g="";if(window.location.host.toLowerCase().indexOf("travel.elong")>=0){g=String.format(FillOrderController.ForgetPassUrl,encodeURIComponent(h),this.GetRequest("campaign_id"));}else{g=String.format(FillOrderController.ForgetPassUrl,encodeURIComponent(h));}window.open(g,"_blank");break;case"unionLogin":var b=encodeURIComponent(this.pageUrl);var a=String.format(c.attr("url"),b);window.open(a);break;case"reallogin":this.RealLogin();break;}},closeLoginDailog:function(){this.loginInfo.hide();},displayDelivery:function(b){var a=$("#delivery");a.find("div[method='deliverytype']").each(function(){if(b==$(this).attr("dltype")&&b!="0"){$(this).css("display","inline-block");}else{$(this).css("display","none");}});},ShowPromoteList:function(a){var b=a.attr("pid");var c=a.attr("price");if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(d){FillOrderController.GetPromotInfo(b,function(e){if(e.success){d.htmlContent=e.value.toString().replace("#price#",c);d.show();}}.bind(this),true);}});},StopOver:function(b,a){var c=Object.clone(this.orderData.RequestInfo);if(a.attr("flighttype")=="go"){c.PageName="golist";}else{c.PageName="backlist";}FillOrderController.GetStopOverInfo(b,c,function(d){if(d.success){if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({htmlContent:"<div >"+d.value+"</div>",eventElement:a,defer:false,width:240});}}.bind(this));},ShowPCA:function(a){var b=0;var d=0;if(a.attr("method")=="dlMlSelectProvince"){b=0;d=0;}else{if(a.attr("method")=="dlMlSelectCity"){b=parseInt(a.parent().parent().find("input[method='dlMlSelectProvince']").attr("pcaid"));if(a.parent().parent().find("input[method='dlMlSelectProvince']").val()==""){b="";}d=1;}else{if(a.attr("method")=="dlMlSelectArea"){b=parseInt(a.parent().parent().find("input[method='dlMlSelectCity']").attr("pcaid"));if(a.parent().parent().find("input[method='dlMlSelectProvince']").val()==""||a.parent().parent().find("input[method='dlMlSelectCity']").val()==""){b="";}d=2;}else{return;}}}var c=new Array();c.push({Name:"北京",ID:"42"});c.push({Name:"上海",ID:"62"});c.push({Name:"天津",ID:"175"});c.push({Name:"重庆",ID:"196"});if(b.toString()!=""){FillOrderController.GetPCA(b,d,function(f){if(f.success){var e=f.value;if(e.length==0){return;}new SelectDropListWindow({data:e,eventElement:a,fieldName:"NameCN",onSelected:function(h){a.val(e[h].NameCN);a.addClass("black");a.attr("pcaid",e[h].ID);if(a.attr("method")=="dlMlSelectProvince"){a.parent().parent().find("input[method='dlMlSelectCity']").attr("pcaid","");a.parent().parent().find("input[method='dlMlSelectCity']").val("");a.parent().parent().find("input[method='dlMlSelectArea']").attr("pcaid","");a.parent().parent().find("input[method='dlMlSelectArea']").val("");}else{if(a.attr("method")=="dlMlSelectCity"){a.parent().parent().find("input[method='dlMlSelectArea']").attr("pcaid","");a.parent().parent().find("input[method='dlMlSelectArea']").val("");}else{if(a.attr("method")=="dlMlSelectArea"){}else{return;}}}for(var g in c){if(e[h].NameCN==c[g].Name){a.parent().parent().find("input[method='dlMlSelectCity']").attr("pcaid",c[g].ID);a.parent().parent().find("input[method='dlMlSelectCity']").val(c[g].Name);}}}});}});}else{return;}},GetPCA:function(b){var d=0;var a=b.val().trim();b.attr("pcaid","");var e=new Array();e.push({Name:"北京",ID:"42"});e.push({Name:"上海",ID:"62"});e.push({Name:"天津",ID:"175"});e.push({Name:"重庆",ID:"196"});if(b.attr("method")=="dlMlSelectProvince"){d=0;FillOrderController.GetProvinceByName(a,function(f){if(f.success&&f.value!="0"){b.attr("pcaid",f.value);}});for(var c in e){if(a==e[c].Name){b.parent().parent().find("input[method='dlMlSelectCity']").attr("pcaid",e[c].ID);b.parent().parent().find("input[method='dlMlSelectCity']").val(e[c].Name);}}}else{if(b.attr("method")=="dlMlSelectCity"){d=parseInt(b.parent().parent().find("input[method='dlMlSelectProvince']").attr("pcaid"));FillOrderController.GetCityByName(d,a,function(f){if(f.success&&f.value!="0"){b.attr("pcaid",f.value);}});}else{if(b.attr("method")=="dlMlSelectArea"){d=parseInt(b.parent().parent().find("input[method='dlMlSelectCity']").attr("pcaid"));FillOrderController.GetAreaByName(d,a,function(f){if(f.success&&f.value!="0"){b.attr("pcaid",f.value);}});}else{return;}}}},ShowStreet:function(){var b=this.dvdelivery.find("input[method='txtMlAddress']");var a="";a=this.dvdelivery.find("input[method='dlMlSelectArea']").attr("pcaid");if(this.autosteet!=null){this.autosteet.dispose();}if(a!=""){FillOrderController.GetStreet(a,function(e){if(e.success){var d=new Array();for(var c in e.value){if(e.value[c].NameCN.indexOf(b.val())>-1||e.value[c].NameEN.indexOf(b.val())>-1){d.push(e.value[c]);}}if(d.length==0){return;}this.autosteet=new SelectDropListWindow({data:d,eventElement:b,fieldName:"NameCN",onSelected:function(f){b.val(d[f].NameCN);b.addClass("black");}});}else{return;}}.bind(this),true);}else{return;}},FlightRestriction:function(a){if(this.listWindow!=null){this.listWindow.close();}var b=a.attr("leg");this.listWindow=new TipWindow({eventElement:a,defer:false,width:240,buildHtmlContent:function(c){FillOrderController.RestrictionRule(this.cacheKey,b,function(d){if(d.success){c.htmlContent="<div >"+d.value+"</div>",c.show();}}.bind(this),true);}.bind(this)});},getOrderTotalAmount:function(){var k=this.dvpassenger.children("div[class='passenger_wrap']");var o=0;var c=0;var a=0;var b=0;for(var e=0;e<k.length;e++){var l=k.eq(e);var j=new Object();var h=this.getFormElement(l);j.PassengerType=parseInt(k.eq(e).find("input[method='passengertype']:checked").val());var m=0;var n=0;var d=0;var f=0;if(j.PassengerType=="0"){n=parseInt(FillOrderController.OrderModel.AdultPrice);if(FillOrderController.isPromotionPackage==true){n=FillOrderController.PackagePrice;}d=parseInt(FillOrderController.OrderModel.AdultFee);l.find("span[method='ticket']").html(n);l.find("span[method='fee']").html(d);a++;if(FillOrderController.OrderModel.IsLogOn&&FillOrderController.OrderModel.AvailableCoupon>0){c+=this.orderData.ItinerarySupportCoupon;if(FillOrderController.OrderModel.AvailableCoupon<c){c=this.orderData.AvailableCoupon;}}}if(j.PassengerType=="1"){n=parseInt(FillOrderController.OrderModel.ChildPrice);if(FillOrderController.isPromotionPackage==true){n=FillOrderController.PackageChildPrice;}d=parseInt(FillOrderController.OrderModel.ChildFee);l.find("span[method='ticket']").html(n);l.find("span[method='fee']").html(d);b++;}if(j.PassengerType=="2"){n=parseInt(FillOrderController.OrderModel.InfantPrice);d=parseInt(FillOrderController.OrderModel.InfantFee);l.find("span[method='ticket']").html(n);l.find("span[method='fee']").html(d);}if(FillOrderController.InsuranceInfo!=undefined&&FillOrderController.InsuranceInfo!=null&&h.dlInsurance!=undefined){f+=parseInt(h.dlInsurance.val());if(h.spanExtendedInsurance.attr("display")=="True"){f+=parseInt(h.dlExtendedInsurance.val());}}if(FillOrderController.isPromotionPackage==true&&(j.PassengerType=="0"||j.PassengerType=="1")){if(FillOrderController.IsBothPackage==true){if(f==2){m=n+d;}else{m=n+d+(f-2)*parseInt(FillOrderController.PackageInsuranceAmount);}}else{if(f==1){m=n+d;}else{m=n+d+(f-1)*parseInt(FillOrderController.PackageInsuranceAmount);}}}else{m=n+d+f*(FillOrderController.InsuranceInfo!=null?parseInt(FillOrderController.InsuranceInfo.InsurancePricePer):0);}o+=m;if(f==0){l.find("span[method='insurance']").hide();l.find("span[method='insurancespan']").hide();}else{if(FillOrderController.isPromotionPackage==false){l.find("span[method='insurance']").html(f*parseInt(FillOrderController.InsuranceInfo.InsurancePricePer));}else{if(this.language=="CN"){l.find("span[method='insurance']").html(f+"份");}else{if(f==1){l.find("span[method='insurance']").html(f+"copy");}else{l.find("span[method='insurance']").html(f+"copies");}}}l.find("span[method='insurance']").show();l.find("span[method='insurancespan']").show();}l.find("span[method='price']").html(m);if(k.length==1){l.find("a[method='DeletePassenger']").hide();}else{l.find("a[method='DeletePassenger']").show();}}if(a+b+1>parseInt(FillOrderController.MinTicketCount)){if(parseInt(FillOrderController.MinTicketCount)!=1){var g=this.resource.Js_TicketCountLimit.replace("{0}",FillOrderController.MinTicketCount).replace("{1}",$("#ListURL").val());this.dvContactInfoRegion.find("span[method='ticketcount']").html(g);this.dvContactInfoRegion.find("span[method='ticketcount']").show();}$("a[method='AddPassenger']").addClass("mo_disable");}else{this.dvContactInfoRegion.find("span[method='ticketcount']").hide();$("a[method='AddPassenger']").removeClass("mo_disable");}return{AdultCount:a,ChildCount:b,Total:o,Coupon:c};},refreshCouponAmount:function(){this.orderData.ConsumedCoupon=FillOrderController.OrderModel.ConsumedCoupon=this.getOrderTotalAmount().Coupon;$("span[method='consumedCoupon']").html(this.orderData.ConsumedCoupon);},refreshMainAmount:function(){var a=this.getOrderTotalAmount();var b=a.Total;$("em[method='totalprice']").html(b);},refreshAmount:function(){if(this.orderData.IsSupportCoupon){this.refreshCouponAmount();}this.refreshMainAmount();},validatePassenger:function(){var result=true;var adult=0;var child=0;var infant=0;var regCNEN=new RegExp("^[\u4e00-\u9fa5]{1}([\u4e00-\u9fa5 ]*[A-Za-z ]*)$");var regCN=new RegExp("^[\u4e00-\u9fa5 ]+$");var regEN=new RegExp("^[a-zA-Z ]+$");var passengers=this.orderData.PassengerList;for(var i=0;i<passengers.length;i++){if(passengers[i].PassengerType==2){if(this.language=="EN"){if(!validator.valid(passengers[i].GivenName,"notEmpty")){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerEmptyGivenName);result=false;}if(!validator.valid(passengers[i].FamilyName,"notEmpty")){$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerEmptyFamilyName);result=false;}if(!validator.regularValidate(passengers[i].GivenName,regEN)){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerName);result=false;}if(!validator.regularValidate(passengers[i].FamilyName,regEN)){$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerName);result=false;}}if(!validator.valid(passengers[i].NameEn,"notEmpty")){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_PassengerName);}result=false;}if(validator.valid(passengers[i].NameEn,"cnString")&&!validator.valid(passengers[i].NameEn,"textRange",1,16)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_InfantNameLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_InfantNameLimit);}result=false;}if(validator.valid(passengers[i].NameEn,"passengerName")&&!validator.valid(passengers[i].NameEn,"textRange",1,17)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_InfantNameEnLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_InfantNameEnLimit);}result=false;}if(validator.regularValidate(passengers[i].NameEn,regCNEN)&&!validator.valid(passengers[i].NameEn,"textRange",1,17)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_InfantNameEnLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_InfantNameEnLimit);}result=false;}if(this.language=="EN"){if(validator.regularValidate(passengers[i].GivenName,regEN)&&validator.regularValidate(passengers[i].FamilyName,regEN)&&!validator.valid(passengers[i].NameEn,"passengerName")){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerName);result=false;}}else{if(!validator.valid(passengers[i].NameEn,"passengerName")){$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_PassengerName);result=false;}}if(validator.valid(passengers[i].Name,"notEmpty")&&!validator.valid(passengers[i].Name,"cnString")){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_PassengerNameCN);}else{$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_PassengerNameCN);}result=false;}if(validator.valid(passengers[i].Name,"notEmpty")&&validator.valid(passengers[i].Name,"cnString")&&!validator.valid(passengers[i].Name,"textRange",3,16)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_InfantNameLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_InfantNameLimit);}result=false;}}else{if(passengers[i].PassengerType==0){if(this.language=="EN"){if(!validator.valid(passengers[i].GivenName,"notEmpty")){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerEmptyGivenName);result=false;}if(!validator.valid(passengers[i].FamilyName,"notEmpty")){$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerEmptyFamilyName);result=false;}if(!validator.regularValidate(passengers[i].GivenName,regCNEN)&&!validator.regularValidate(passengers[i].GivenName,regEN)){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerName);result=false;}if(!validator.regularValidate(passengers[i].FamilyName,regCN)&&!validator.regularValidate(passengers[i].FamilyName,regEN)){$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerName);result=false;}}if(!validator.valid(passengers[i].Name,"notEmpty")){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_PassengerName);}result=false;}if(!validator.valid(passengers[i].Name,"cnString")&&!validator.valid(passengers[i].Name,"passengerName")&&!validator.regularValidate(passengers[i].Name,regCNEN)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_PassengerName);}else{$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerName);}result=false;}if(validator.valid(passengers[i].Name,"cnString")&&!validator.valid(passengers[i].Name,"textRange",3,20)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_AdultNameLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_AdultNameLimit);}result=false;}if(validator.valid(passengers[i].Name,"passengerName")&&!validator.valid(passengers[i].Name,"textRange",1,27)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_AdultNameEnLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_AdultNameEnLimit);}result=false;}if(validator.regularValidate(passengers[i].Name,regCNEN)&&!validator.valid(passengers[i].Name,"textRange",1,27)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_AdultNameEnLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_AdultNameEnLimit);}result=false;}}else{if(this.language=="EN"){if(!validator.valid(passengers[i].GivenName,"notEmpty")){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerEmptyGivenName);result=false;}if(!validator.valid(passengers[i].FamilyName,"notEmpty")){$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerEmptyFamilyName);result=false;}if(!validator.regularValidate(passengers[i].GivenName,regCNEN)&&!validator.regularValidate(passengers[i].GivenName,regEN)){$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerName);result=false;}if(!validator.regularValidate(passengers[i].FamilyName,regCN)&&!validator.regularValidate(passengers[i].FamilyName,regEN)){$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerName);result=false;}}if(!validator.valid(passengers[i].Name,"notEmpty")){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_PassengerName);}result=false;}if(!validator.valid(passengers[i].Name,"cnString")&&!validator.valid(passengers[i].Name,"passengerName")&&!validator.regularValidate(passengers[i].Name,regCNEN)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_PassengerName);}else{$error(this.dvpassenger.find("input[method='txtPassFName']").eq(i),this.resource.Js_PassengerName);}result=false;}if(validator.valid(passengers[i].Name,"cnString")&&!validator.valid(passengers[i].Name,"textRange",3,20)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_ChildNameLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_ChildNameLimit);}result=false;}if(validator.valid(passengers[i].Name,"passengerName")&&!validator.valid(passengers[i].Name,"textRange",1,24)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_ChildNameEnLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_ChildNameEnLimit);}result=false;}if(validator.regularValidate(passengers[i].Name,regCNEN)&&!validator.valid(passengers[i].Name,"textRange",1,24)){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']:visible").eq(i),this.resource.Js_ChildNameEnLimit);}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_ChildNameEnLimit);}result=false;}}}if(passengers[i].PassengerType=="0"||passengers[i].PassengerType=="1"){if(passengers[i].CertType!="4"){if(!validator.valid(passengers[i].CertNumber,"notEmpty")||!validator.regularValidate(passengers[i].CertNumber,new RegExp("^[A-Za-z0-9]+$"))){$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),this.resource.Js_PassengerCertificateNO);result=false;}if(passengers[i].CertType=="0"&&!validator.valid(passengers[i].CertNumber,"idCard")){$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),this.resource.Js_PassengerIDNo);result=false;}}else{if(!validator.valid(passengers[i].CertNumber,"notEmpty")||!validator.regularValidate(passengers[i].CertNumber,new RegExp("^[A-Za-z0-9|(|)|）|（]+$"))){$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),this.resource.Js_PassengerCertificateNO);result=false;}}}var launchtime=FillOrderController.DateRange[1];var now=FillOrderController.DateRange[0];var birthday=validator.reFormatDateString(passengers[i].Birthday);var year=0;var month=0;var day=0;if(birthday.indexOf("-")>-1){var dateArray=birthday.split("-");if(dateArray.length!=3){return"";}year=new Number(dateArray[0]);month=new Number(dateArray[1]);day=new Number(dateArray[2]);}var twoyears=(year+2)+"-"+month+"-"+day;var twelveyears=(year+12)+"-"+month+"-"+day;if(birthday=="yyyy-mm-dd"||birthday=="mm/dd/yyyy"||birthday==""){$error(this.dvpassenger.find("input[method='txtBirthday']").eq(i),this.resource.Js_PassengerBirthday);result=false;}if(passengers[i].PassengerType=="0"){adult++;if(birthday!="0000-01-01"){if(FillOrderController.OrderModel.AdultType=="Youth"||FillOrderController.OrderModel.AdultType=="Senior"){var minyear=(year+this.MinAge)+"-"+month+"-"+day;var maxyear=(year+this.MaxAge+1)+"-"+month+"-"+(day-1);if(!validator.valid(launchtime,"dateRange",minyear,maxyear)){var error="";if(this.MaxAge==200){error=String.format(this.resource.Js_PassengerSeniorTip,this.MinAge);}else{error=String.format(this.resource.Js_PassengerYouthTip,this.MinAge,this.MaxAge);}if(passengers[i].CertType!="0"){$error(this.dvpassenger.find("input[method='txtBirthday']").eq(i),error);}else{$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),error);}result=false;}}else{if(!validator.valid(launchtime,"dateRange",twelveyears,null)||!validator.valid(birthday,"dateRange",null,now)||!validator.valid(birthday,this.language=="CN"?"date":"dateEn")){if(passengers[i].CertType!="0"){$error(this.dvpassenger.find("input[method='txtBirthday']").eq(i),this.resource.Js_PassengerAdultTip);}else{$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),this.resource.Js_PassengerCertificateNO);}result=false;}}}}else{if(passengers[i].PassengerType=="1"){child++;if(twelveyears.indexOf("-")>-1){var dateArray=twelveyears.split("-");year=parseInt(dateArray[0]);month=parseInt(dateArray[1]);day=parseInt(dateArray[2])-1;twelveyears=year+"-"+month+"-"+day;}if(!validator.valid(launchtime,"dateRange",twoyears,twelveyears)||!validator.valid(birthday,"dateRange",null,now)||!validator.valid(birthday,this.language=="CN"?"date":"dateEn")){if(passengers[i].CertType!="0"){$error(this.dvpassenger.find("input[method='txtBirthday']").eq(i),this.resource.Js_PassengerChildTip);}else{$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),this.resource.Js_PassengerChildTip);}result=false;}}else{infant++;if(twoyears.indexOf("-")>-1){var dateArray=twoyears.split("-");year=parseInt(dateArray[0]);month=parseInt(dateArray[1]);day=parseInt(dateArray[2])-1;twoyears=year+"-"+month+"-"+day;}if(!validator.valid(launchtime,"dateRange",birthday,twoyears)||!validator.valid(birthday,"dateRange",null,now)||!validator.valid(birthday,this.language=="CN"?"date":"dateEn")){$error(this.dvpassenger.find("input[method='txtBirthday']").eq(i),this.resource.Js_PassengerInFantTip);result=false;}}}var insurance=0;var add_insurance=0;if(passengers[i].InsuranceInfo!=undefined&&passengers[i].InsuranceInfo!=null){insurance=passengers[i].InsuranceInfo.InsuranceNumber;}if(passengers[i].AdditionalInsurance!=undefined&&passengers[i].AdditionalInsurance!=null){add_insurance=passengers[i].AdditionalInsurance.InsuranceNumber;}if(insurance>0||add_insurance>0){var status=0;for(var k=0;k<FillOrderController.InsuranceInfo.Rule.length;k++){if(!validator.valid(passengers[i].Birthday,"notEmpty")||!validator.valid(passengers[i].Birthday,this.language=="CN"?"date":"dateEn")||passengers[i].Birthday==this.resource.DateTimeFormat){if(this.dvpassenger.find("input[method='txtBirthday']").eq(i)!=null){$error(this.dvpassenger.find("input[method='txtBirthday']").eq(i),this.resource.Js_PassengerInsuranceDate);}else{$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(i),this.resource.Js_PassengerInsuranceDate);}result=false;}var temp_birthday=validator.convertDate(passengers[i].Birthday);var startdate=(temp_birthday.getFullYear()+FillOrderController.InsuranceInfo.Rule[k].StartAge)+"-"+(temp_birthday.getMonth()+1)+"-"+temp_birthday.getDate();var enddate=(temp_birthday.getFullYear()+FillOrderController.InsuranceInfo.Rule[k].EndAge)+"-"+(temp_birthday.getMonth()+1)+"-"+temp_birthday.getDate();if(validator.valid(launchtime,"dateRange",startdate,enddate)){var max_num=FillOrderController.InsuranceInfo.Rule[k].MaxNumber;var message=this.resource.Js_PassengerInsurance;message=message.replace("{MAX}",max_num);if(parseInt(insurance)>max_num){$error(this.dvpassenger.find("select[method='dlInsurance']").eq(i),message);result=false;}else{status=1;}if(parseInt(add_insurance)>max_num){$error(this.dvpassenger.find("select[method='dlExtendedInsurance']").eq(i),message);result=false;}else{status=1;}}}if(status==0){var message=this.resource.Js_PassengerInsurance;message=message.replace("{MAX}",0);$error(this.dvpassenger.find("select[method='dlInsurance']").eq(i),message);result=false;}}}if(adult==0){if(this.dvpassenger.find("a[method='AddPassenger']:visible").length>0){$error(this.dvpassenger.find("a[method='AddPassenger']"),this.resource.Js_PassengerAdultLimit);}else{$error($("#btnSaveOrder"),this.resource.Js_PassengerAdultLimit);}result=false;}else{var childRate=child/adult;var infantRate=infant/adult;if(this.childRuleRate<childRate||this.infantRuleRate<infantRate){var templateHTML=new Template(this.resource.Js_PassengerAdultChildInfant);var Js_Tip=templateHTML.eval({child:this.childRuleRate,infant:this.infantRuleRate});if(this.dvpassenger.find("a[method='AddPassenger']:visible").length>0){$error(this.dvpassenger.find("a[method='AddPassenger']"),Js_Tip);}else{$error($("#btnSaveOrder"),Js_Tip);}result=false;}}for(var i=0;i<passengers.length;i++){for(var j=passengers.length-1;j>i;j--){if(passengers[i].PassengerType!="2"&&passengers[i].CertNumber==passengers[j].CertNumber&&passengers[i].CertType==passengers[j].CertType){$error(this.dvpassenger.find("input[method='txtCertificateNo']").eq(j),this.resource.Js_PassengerCertificateRule);result=false;}}}if(passengers[0].PassengerCardNo.length>0){for(var i=0;i<passengers.length;i++){for(var k=0;k<passengers[0].PassengerCardNo.length;k++){var sameCard=passengers[i].PassengerCardNo[k];if(String.isNullOrEmpty(sameCard)){continue;}for(var j=passengers.length-1;j>i;j--){if(sameCard==passengers[j].PassengerCardNo[k]){$error(this.dvpassenger.find("input[method='txtAirMember']").eq(k),this.resource.Js_PassengerAirCardRule);result=false;}}}}}for(var i=0;i<passengers.length;i++){for(var j=passengers.length-1;j>i;j--){if(passengers[i].PassengerType=="2"&&passengers[j].PassengerType=="2"&&passengers[i].Name!=""){if(passengers[i].Name.toLowerCase()==passengers[j].Name.toLowerCase()){if(this.language=="CN"){$error(this.dvpassenger.find("input[method='txtPassengerName']").eq(i),this.resource.Js_PassengerNameDuplicate);}else{$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_PassengerNameDuplicate);}result=false;}}}}for(var i=0;i<passengers.length;i++){for(var j=passengers.length-1;j>i;j--){if(passengers[i].NameEn.toLowerCase()==passengers[j].NameEn.toLowerCase()){if(this.language=="CN"){if(passengers[i].PassengerType=="2"){$error(this.dvpassenger.find("input[method='txtInfantName']").eq(i),this.resource.Js_PassengerNameDuplicate);}else{$error(this.dvpassenger.find("input[method='txtPassengerName']").eq(i),this.resource.Js_PassengerNameDuplicate);}}else{$error(this.dvpassenger.find("input[method='txtPassLName']").eq(i),this.resource.Js_PassengerNameDuplicate);}result=false;}}}if(adult+child>parseInt(FillOrderController.MinTicketCount)){result=false;}return result;},validateContact:function(){var b=true;if(this.language!="EN"){if(!validator.valid(this.orderData.Contact.MobilePhone,this.language=="CN"?"notEmpty & mobile":"notEmpty & number")){$error(this.formElement.txtMobilePhone,this.resource.Js_ContactMobile);b=false;}}var a=false;if(this.language=="EN"){a=true;}else{a=this.orderData.Contact.Email!=this.resource.Optional;}if(a&&!validator.valid(this.orderData.Contact.Email,this.language=="CN"?"email":"notEmpty & email")){$error(this.formElement.txtEmail,this.resource.Js_ContactEmail);b=false;}return b;},getFormElement:function(a,b){var d=new Object();for(var c=0;c<arguments.length;c++){var e=arguments[c];e.find("input[type='text']").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("a").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("span").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("li").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("input[type='checkbox']").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("input[type='radio']").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("select").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});}return d;},getOrderData:function(){var r=this.dvpassenger.children("div[class='passenger_wrap']");if(this.orderData.PassengerList.length>0){this.orderData.PassengerList.splice(0,this.orderData.PassengerList.length);}for(var h=0;h<r.length;h++){var s=r.eq(h);var q=new Object();var o=this.getFormElement(s);q.PassengerType=parseInt(r.eq(h).find("input[method='passengertype']:checked").val());if(this.language=="EN"){var f=s.find("input[method='txtPassFName']").val().trim();var l=s.find("input[method='txtPassLName']").val().trim();q.GivenName=f==this.resource.Passenger_FirstName?"":f;q.FamilyName=l==this.resource.Passenger_LastName?"":l;}if(FillOrderController.IsBindInsuranceGo==true||FillOrderController.IsBindInsuranceBack==true){q.IsBindInsurance=true;}q.Name=this.getPassengerName(q.PassengerType,s).trim();q.NameEn=q.Name;if(q.PassengerType=="2"){if(this.language=="CN"){q.NameEn=o.txtInfantName.val().trim();var m=q.NameEn;if(m.split("/").length>1){var j=m.indexOf("/");var k=m.substring(0,j).trim();k=k.replace(/\s/g,"");var v=m.substring(j+1,m.length).trim();m=String.format("{0}/{1}",k,v);}q.NameEn=m;var u=s.find("input[method='txtPassengerName']:visible").val().trim();if(u==s.find("input[method='txtPassengerName']:visible").attr("default")){u="";}q.Name=u;}else{if(this.language=="EN"){q.NameEn=this.getPassengerName(q.PassengerType,s).trim();q.Name=o.txtInfantName.val();}}q.Name=q.Name.replace(/\s/g,"");}q.CertType=o.dlCertType.val();q.CertNumber=o.txtCertificateNo.val().trim();q.AirCorpIds=new Array();q.PassengerCardNo=new Array();if(FillOrderController.InsuranceInfo!=undefined&&FillOrderController.InsuranceInfo!=null&&o.dlInsurance!=undefined){q.InsuranceInfo=new Object();q.InsuranceInfo.InsuredPersonBirthday=o.txtBirthday.val().trim();q.InsuranceInfo.InsuranceNumber=o.dlInsurance.val();q.InsuranceInfo.InsurancePricePer=FillOrderController.InsuranceInfo.InsurancePricePer;q.InsuranceInfo.ValidDate=FillOrderController.DateRange[1];q.InsuranceInfo.Rule=FillOrderController.InsuranceInfo.Rule;q.InsuranceInfo.InsuranceDescription="";q.InsuranceInfo.InsuranceDescriptionUrl=FillOrderController.InsuranceInfo.InsuranceDescriptionUrl;q.InsuranceInfo.TimeLimit=FillOrderController.InsuranceInfo.TimeLimit;q.AdditionalInsurance=Object.clone(q.InsuranceInfo);if(o.spanExtendedInsurance.attr("display")=="True"){q.AdditionalInsurance.InsuranceNumber=o.dlExtendedInsurance.val();q.AdditionalInsurance.ValidDate=FillOrderController.SupportExInsuranceDate;}else{q.AdditionalInsurance.InsuranceNumber=0;q.AdditionalInsurance.ValidDate="0000-1-1";}}q.Birthday="0000-1-1";if(o.txtBirthday!=null&&o.txtBirthday!=undefined){if(q.PassengerType==0&&q.InsuranceInfo!=null&&q.InsuranceInfo.InsuranceNumber>0){q.Birthday=validator.reFormatDateString(o.txtBirthday.val().trim());}if(q.PassengerType==0&&q.AdditionalInsurance!=null&&q.AdditionalInsurance.InsuranceNumber>0){q.Birthday=validator.reFormatDateString(o.txtBirthday.val().trim());}if(q.PassengerType==0&&q.CertType==0){q.Birthday=validator.reFormatDateString(o.txtBirthday.val().trim());}if(q.PassengerType==0&&(FillOrderController.OrderModel.AdultType=="Youth"||FillOrderController.OrderModel.AdultType=="Senior")){q.Birthday=validator.reFormatDateString(o.txtBirthday.val().trim());}if(q.PassengerType==1){q.Birthday=validator.reFormatDateString(o.txtBirthday.val().trim());}if(q.PassengerType==2){q.Birthday=validator.reFormatDateString(o.txtBirthday.val().trim());}}this.orderData.PassengerList.push(q);}var e="";for(var n in this.orderData.PassengerList){if(this.orderData.PassengerList[n].PassengerType==0){e=this.orderData.PassengerList[n].Name;break;}}this.orderData.Contact.Name=e;this.orderData.Contact.MobilePhone=this.formElement.txtMobilePhone.val().trim();var w=this.language=="CN"?this.resource.Optional:this.resource.Required;this.orderData.Contact.Email=this.formElement.txtEmail.val().trim();this.orderData.Contact.Email=this.orderData.Contact.Email==w?"":this.orderData.Contact.Email;this.orderData.DeliveryType=this.dvdelivery.find("input[method='DeliveryType']:checked").val();switch(this.orderData.DeliveryType){case"1":this.orderData.DelMail.ContactPerson=this.formElement.txtMlName.val().trim();this.orderData.DelMail.Province=this.formElement.dlMlSelectProvince.val().trim();this.orderData.DelMail.ProvinceID=this.formElement.dlMlSelectProvince.attr("pcaid");this.orderData.DelMail.City=this.formElement.dlMlSelectCity.val().trim();this.orderData.DelMail.CityID=this.formElement.dlMlSelectCity.attr("pcaid");this.orderData.DelMail.SmallCity=this.formElement.dlMlSelectArea.val().trim();this.orderData.DelMail.SmallCityID=this.formElement.dlMlSelectArea.attr("pcaid");this.orderData.DelMail.Address=this.formElement.txtMlAddress.val().trim();this.orderData.DelMail.ContactPhone=this.formElement.txtMlPhone.val().trim();this.orderData.DelMail.PostCode="";if(this.orderData.IsNeedInvoice){this.orderData.Invoice.Title=this.formElement.txtMlInvoice.val().trim();}break;case"4":var t=this.dvdelivery.find("input[method='pickup']:checked");var a=t.attr("address");var g=t.val();var d=0;var b=0;var c="";if(g=="2"){b=t.attr("areaid");c=t.attr("airportcode");}if(g=="3"){b=t.attr("areaid");d=t.attr("cityid");c=t.attr("citycode");}if(g=="3"){b=t.attr("areaid");d=t.attr("cityid");c=t.attr("citycode");}this.orderData.DelPickUp.AreaId=b;this.orderData.DelPickUp.CityId=d;this.orderData.DelPickUp.CityCode=c;this.orderData.DelPickUp.AreaName=a;this.orderData.DelPickUp.From=g;break;default:break;}},validData:function(){var a=true;this.getOrderData();a=this.validatePassenger()&&this.validateContact();if(FillOrderController.OrderModel.IsUsedCoupon&&FillOrderController.OrderModel.ConsumedCoupon>FillOrderController.OrderModel.AvailableCoupon){this.orderData.ConsumedCoupon=FillOrderController.OrderModel.AvailableCoupon;}else{this.orderData.ConsumedCoupon=this.getOrderTotalAmount().Coupon;}this.orderData.DeliveryType=this.dvdelivery.find("input[method='DeliveryType']:checked").val();switch(this.orderData.DeliveryType){case"1":if(!validator.valid(this.orderData.DelMail.ContactPerson,"notEmpty & nonSpecialSign")){$error(this.formElement.txtMlName,this.resource.Js_NoMailName);a=false;}if(!validator.valid(this.orderData.DelMail.ContactPhone,"notEmpty & mobile")){$error(this.formElement.txtMlPhone,this.resource.Js_NoMailPhone);a=false;}if(this.language=="CN"){if(!validator.valid(this.orderData.DelMail.Province,"notEmpty & nonSpecialSign")||this.orderData.DelMail.Province=="--省份--"){$error(this.formElement.dlMlSelectProvince,this.resource.Js_NoProvince);a=false;}if(!validator.valid(this.orderData.DelMail.City,"notEmpty & nonSpecialSign")||this.orderData.DelMail.City=="--城市--"){$error(this.formElement.dlMlSelectCity,this.resource.Js_NoProvince);a=false;}if(!validator.valid(this.orderData.DelMail.SmallCity,"notEmpty & nonSpecialSign")||this.orderData.DelMail.SmallCity=="--区县--"){$error(this.formElement.dlMlSelectArea,this.resource.Js_NoProvince);a=false;}}if(!validator.valid(this.orderData.DelMail.Address,"notEmpty & nonSpecialSign")){$error(this.formElement.txtMlAddress,this.resource.Js_NoMailAddress);a=false;}if(validator.valid(this.orderData.DelMail.Address,"textRange",0,8)){$error(this.formElement.txtMlAddress,this.resource.Js_MailAddressLength);a=false;}if(this.orderData.DelMail.Address.substring(this.orderData.DelMail.Address.length-2,this.orderData.DelMail.Address.length)=="信箱"){$error(this.formElement.txtMlAddress,this.resource.Js_DeliveryPost);a=false;}if(this.orderData.IsNeedInvoice){if(!validator.valid(this.orderData.Invoice.Title,"notEmpty & nonSpecialSign")){$error(this.formElement.txtMlInvoice,this.resource.Js_NoInvoiceTitle);a=false;}if(validator.valid(this.orderData.Invoice.Title,"textRange",0,8)){$error(this.formElement.txtMlInvoice,this.resource.Js_MailAddressLength);a=false;}}break;case"4":if(!validator.valid(this.orderData.DelPickUp.AreaName,"notEmpty")){$error(this.dvdelivery.find("input[method='DeliveryType'][value='4']"),this.resource.Js_PickupAtPort_NoChoice);a=false;}break;default:break;}if(FillOrderController.IsSupportContrast&&this.orderData.ContrastInfo.IsNeedContrast){if($("#contrast")!=null&&$("#contrast textarea").length!=0){this.orderData.ContrastInfo.Description=$("#contrast textarea").val();if(!validator.valid(this.orderData.ContrastInfo.Description,"notEmpty")){$error($("#contrast").find("textarea").eq(0),this.resource.Js_Contrast_Description_Empty);a=false;}if(this.orderData.ContrastInfo.Description.length>1000){$error($("#contrast").find("textarea").eq(0),this.resource.Js_Contrast_Description_Length);a=false;}}}return a;},getPassengerName:function(k,f){var e=new String();if(this.language=="CN"){if(k!="2"){e=f.find("input[method='txtPassengerName']:visible").val().trim();}else{e=f.find("input[method='txtInfantName']:visible").val().trim();}}else{var a=f.find("input[method='txtPassFName']").val().trim();var d=f.find("input[method='txtPassLName']").val().trim();a=a==this.resource.Passenger_FirstName?"":a;d=d==this.resource.Passenger_LastName?"":d;var h=new RegExp("^[\u4e00-\u9fa5 ]{1}([\u4e00-\u9fa5 ]*[A-Za-z ]*)$");var i=new RegExp("^[a-zA-Z ]+$");var g=new RegExp("^[\u4e00-\u9fa5 ]+$");if(validator.regularValidate(d,i)){e=String.format("{0}/{1}",d,a);if(e=="/"){e="";}}else{if(validator.regularValidate(d,g)){e=String.format("{0}{1}",d,a);e=e.replace(/\s/g,"");}else{if(validator.regularValidate(d,h)){e=String.format("{0}{1}",d,a);}else{e=String.format("{0}{1}",d,a);}}}}if(e.split("/").length>1){var b=e.indexOf("/");var c=e.substring(0,b).trim();c=c.replace(/\s/g,"");var j=e.substring(b+1,e.length).trim();j=j.replace(/\s+/g," ");e=String.format("{0}/{1}",c,j);}else{e=e.replace(/\s/g,"");}return e;},GetBirthdayFromID:function(a){if(this.language=="CN"){if(a.length==18){return a.slice(6,10)+"-"+(a.slice(10,12))+"-"+a.slice(12,14);}if(a.length==15){return"19"+a.slice(6,8)+"-"+(a.slice(8,10))+"-"+a.slice(10,12);}}else{if(a.length==18){return a.slice(10,12)+"/"+a.slice(12,14)+"/"+a.slice(6,10);}if(a.length==15){return a.slice(8,10)+"/"+a.slice(10,12)+"/19"+a.slice(6,8);}}},AddPassengerfromHistory:function(g,d){var i;if(this.language=="CN"){i=this.dvpassenger.find("div[class='passenger_wrap'][passengername='newPassenger']").filter(function(){return $(this).find("input[method='txtPassengerName'][value='']").length>0;});}else{i=this.dvpassenger.find("div[class='passenger_wrap'][passengername='newPassenger']").filter(function(){return $(this).find("input[method='txtPassFName'][value='Given Name']").length>0;});}var h=i!=null?i.length:0;if(h==0){var a=this.dvpassenger.find("a[method='AddPassenger']");a.click();}var c=(h!=0&&i!=undefined)?i.eq(0):this.dvpassenger.find("div[class='passenger_wrap']:last");c.attr("passengername",g);c.attr("id",d);var f=this.language=="CN"?4:8;var j=16;try{FillOrderController.GetSelectCustomerByService(d,this.cacheKey,f,j,function(k){if(k.success){passValue=k.value[0];var e=this.getFormElement(c);this.setPassengerValue(passValue,e,c);}}.bind(this));}catch(b){}this.refreshAmount();},UncheckeSelectedPassengerHis:function(a){var b=this.divpassengerhistory.find("input[method='selectedpassenger'][title='"+a+"']");if(b.attr("checked")){b.attr("checked",false);}},RemovePassengerfromHistory:function(b){var a=this.dvpassenger.find("div[class='passenger_wrap']:first").find("a[method='DeletePassenger']").css("display");if(a!="none"){var d="div.passenger_wrap[passengername='"+b+"']";var c=this.dvpassenger.find(d);c.find("a[method='DeletePassenger']").click();}},setPassengerValue:function(f,d,a){a.find("input[method='passengertype'][value="+f.Type+"]").attr("checked","checked");if(a.find("input[method='passengertype'][value="+f.Type+"]:visible").length==0){a.find("input[method='passengertype'][value='0']").attr("checked","checked");}a.find("input[method='passengertype']:checked").click();if(f.Type=="0"||f.Type=="1"){if(this.language=="CN"){a.find("input[method='txtPassengerName']:visible").val(f.Name);a.find("input[method='txtPassengerName']:visible").addClass("black");}else{var e=f.Name.split("/");if(!String.isNullOrEmpty(e[1])){d.txtPassLName.val(e[0]);d.txtPassFName.val(e[1]);}else{var c=e[0].substring(0,1);var b=e[0].substring(1);d.txtPassLName.val(c);d.txtPassFName.val(b);}d.txtPassLName.addClass("black");d.txtPassFName.addClass("black");}}else{if(this.language=="CN"){d.txtInfantName.val(f.NameEn);d.txtPassengerName.val(f.Name);if(d.Passenger.find("input[method='txtInfantName']:visible").length==0){d.Passenger.find("input[method='txtPassengerName']").val(f.Name);d.Passenger.find("input[method='txtPassengerName']").addClass("black");}}else{var e=new String();if(!String.isNullOrEmpty(f.NameEn)){e=f.NameEn.split("/");}else{e=f.Name.split("/");}d.txtPassLName.val(e[0]);d.txtPassLName.addClass("black");d.txtPassFName.val("");d.txtInfantName.val(f.Name);if(e.length>1){var g=e[1].split(" ");d.txtPassFName.val(g[0]);d.txtPassFName.addClass("black");}if(d.txtPassFName.val()==""){d.txtPassFName.val(this.resource.Passenger_FirstName);}}}var h=this.language=="CN"?f.BirthdayString:validator.reFormatDateStringEn(f.BirthdayString);if(f.BirthdayString=="0001-01-01"||f.BirthdayString=="1900-01-01"){h=this.resource.DateTimeFormat;}d.txtBirthday.val(h);if(f.Certificates&&f.Certificates.length>0&&!Object.isNull(f.Certificates[0])){d.txtCertificateNo.val(f.Certificates[0].Number);d.txtCertificateNo.addClass("black");d.dlCertType.val(f.Certificates[0].CertType);d.dlCertType.addClass("black");d.dlCertType.change();}else{d.txtCertificateNo.val("");}if(f.Certificates.length>0&&f.Certificates[0].CertType==0){d.txtCertificateNo.change();}},setMailInfoValue:function(a){this.formElement.txtMlName.val(a.ContactPerson);this.formElement.txtMlPhone.val(a.ContactPhone);this.formElement.txtMlAddress.val(a.Address);this.formElement.txtMlName.addClass("black");this.formElement.txtMlPhone.addClass("black");this.formElement.txtMlAddress.addClass("black");if(!String.isNullOrEmpty(a.Province)&&!String.isNullOrEmpty(a.City)&&!String.isNullOrEmpty(a.SmallCity)){this.formElement.dlMlSelectProvince.val(a.Province);this.formElement.dlMlSelectProvince.addClass("black");this.formElement.dlMlSelectProvince.attr("pcaid",a.ProvinceID);this.formElement.dlMlSelectCity.val(a.City);this.formElement.dlMlSelectCity.addClass("black");this.formElement.dlMlSelectCity.attr("pcaid",a.CityID);this.formElement.dlMlSelectArea.val(a.SmallCity);this.formElement.dlMlSelectArea.addClass("black");this.formElement.dlMlSelectArea.attr("pcaid",a.SmallCityID);}},displayCustomerHistory:function(a){var b=this.language=="CN"?4:8;var c=16;FillOrderController.GetCustomerHistoryByService(this.cacheKey,b,c,function(e){if(e.success){var d=e.value;if(d.length==0){return;}new SelectDropListWindow({data:d,eventElement:a,fieldName:"Name",onSelected:function(f){var h=d[f];if(f>0){FillOrderController.GetSelectCustomerByService(h.Id,this.cacheKey,b,c,function(j){if(j.success){h=j.value[0];var i=this.getFormElement(a.parents("div:eq(0)"));this.setPassengerValue(h,i,a.parents("div:eq(0)"));}}.bind(this));}else{var g=this.getFormElement(a.parents("div:eq(0)"));this.setPassengerValue(h,g,a.parents("div:eq(0)"));}}.bind(this)});}}.bind(this));},displayContact:function(){var a=$("#passenger_info").find("input[method='txtEmail']");if(a.val()==""){if(this.language!="EN"){a.val(this.resource.Optional);}else{a.val(this.resource.Required);}}a.removeAttr("class");a.addClass("intxt w04 ");},displayPassenger:function(b,a){a.find("input[type='text']").each(function(){$(this).val("");});a.find("select").each(function(){$(this).val(0);});if(b!="2"){a.find("select[method='dlInsurance']").each(function(){$(this).val(parseInt(FillOrderController.OrderModel.DefaultInsuranceNumber));$(this).parents("span[method='spanInsurance']").attr("number",FillOrderController.OrderModel.DefaultInsuranceNumber);});a.find("select[method='dlExtendedInsurance']").each(function(){$(this).val(parseInt(FillOrderController.OrderModel.DefaultExInsuranceNumber));$(this).parents("span[method='spanExtendedInsurance']").attr("number",FillOrderController.OrderModel.DefaultExInsuranceNumber);});}a.find("input[type='checkbox']").each(function(){$(this).attr("checked",true);});if(this.language=="EN"){a.find("input[method='txtPassFName']").val(this.resource.Passenger_FirstName);a.find("input[method='txtPassLName']").val(this.resource.Passenger_LastName);}a.find("input[method='txtBirthday']").val(this.resource.DateTimeFormat);var c=this.language=="CN"?"证件号码":"";a.find("input[method='txtCertificateNo']").val(c);a.find("input[method='txtAirMember']").each(function(){$(this).val($(this).attr("defaultvalue"));});b.find("input[method='passengertype']:visible").eq(0).attr("checked","checked");b.find("input[method='passengertype']:visible").eq(0).click();if(b.find("input[method='passengertype']:checked").val()=="2"){a.find("li[method='InfantTip']").show();}if(a.find("input[type='checkbox']").attr("checked")){a.find("li[method='ExInsurance']").css("display","block");}else{a.find("li[method='ExInsurance']").css("display","none");}},setInsurance:function(f,c){var e=this.resource.Passenger_InsurancePer2_Go.replace("{0}","0");var d=this.resource.Passenger_InsurancePer2_Back.replace("{0}","0");var b=c.find("span[method='spanInsurance']").attr("number");var a=c.find("span[method='spanExtendedInsurance']").attr("number");if(f=="2"){if(c.find("select[method='dlInsurance'] option:first").val()>0){c.find("select[method='dlInsurance']").prepend("<option value='0'>"+e+"</option>");}c.find("select[method='dlInsurance']").val(0);c.find("select[method='dlInsurance']").change();if(c.find("span[method='spanExtendedInsurance']").attr("display")=="True"){if(c.find("select[method='dlExtendedInsurance'] option:first").val()>0){c.find("select[method='dlExtendedInsurance']").prepend("<option value='0'>"+d+"</option>");}c.find("select[method='dlExtendedInsurance']").val(0);c.find("select[method='dlExtendedInsurance']").change();}}else{if(FillOrderController.IsBindInsuranceGo){c.find("select[method='dlInsurance'] option[value='0']").remove();}else{if(c.find("select[method='dlInsurance'] option:first").val()>0){c.find("select[method='dlInsurance']").prepend("<option value='0'>"+e+"</option>");}}c.find("select[method='dlInsurance']").val(parseInt(b));c.find("select[method='dlInsurance']").change();if(c.find("span[method='spanExtendedInsurance']").attr("display")=="True"){if(FillOrderController.IsBindInsuranceBack){c.find("select[method='dlExtendedInsurance'] option[value='0']").remove();}else{if(c.find("select[method='dlExtendedInsurance'] option:first").val()>0){c.find("select[method='dlExtendedInsurance']").prepend("<option value='0'>"+d+"</option>");}}c.find("select[method='dlExtendedInsurance']").val(parseInt(a));c.find("select[method='dlExtendedInsurance']").change();}}},switchPassenger:function(b,a){if(b=="0"){if(this.language=="EN"){a.find("li[method='cerRegion'] span").eq(1).attr("class","cols01");}a.find("span[class~='passengertype']").appendTo(a.find("li[method='Passenger']"));a.find("li[method='Passenger']").find("input[method~='passengertype']:[value='0']").attr("checked","true");a.find("li[method='Passenger']").show();a.find("li[method='InfantRegion']").each(function(){$(this).hide();});a.find("li[method='cerRegion'] span").eq(1).hide();a.find("li[method='cerRegion'] input[method='txtBirthday']").hide();a.find("li[method='Insurance']:eq(0) span[method='AirCardRegion']").show();a.find("li[method='Insurance']:eq(0) li").eq(1).show();a.find("li[method='Insurance']").each(function(){});a.find("li[method='cerRegion']").each(function(){$(this).show();});a.find("li[method='cerRegion']:eq(0) span").eq(0).show();a.find("li[method='cerRegion']:eq(0) select").show();a.find("li[method='cerRegion'] input[method='txtCertificateNo']").show();if(parseInt(a.find("select[method='dlInsurance']").val())>0&&a.find("select[method='dlCertType']").val()!="0"){a.find("li[method='cerRegion'] span").eq(1).show();a.find("li[method='cerRegion'] input[method='txtBirthday']").show();}if(a.find("span[method='spanExtendedInsurance']").attr("display")=="True"&&parseInt(a.find("select[method='dlExtendedInsurance']").val())>0&&a.find("select[method='dlCertType']").val()!="0"){a.find("li[method='cerRegion'] span").eq(1).show();a.find("li[method='cerRegion'] input[method='txtBirthday']").show();}if((FillOrderController.OrderModel.AdultType=="Youth"||FillOrderController.OrderModel.AdultType=="Senior")&&a.find("select[method='dlCertType']").val()!="0"){a.find("li[method='cerRegion'] span").eq(1).show();a.find("li[method='cerRegion'] input[method='txtBirthday']").show();}a.find("li[method='InfantTip']").hide();}else{if(b=="1"){if(this.language=="EN"){a.find("li[method='cerRegion'] span").eq(1).attr("class","cols01");}a.find("span[class~='passengertype']").appendTo(a.find("li[method='Passenger']"));a.find("li[method='Passenger']").find("input[method~='passengertype']:[value='1']").attr("checked","true");a.find("li[method='Passenger']").show();a.find("li[method='InfantRegion']").each(function(){$(this).hide();});a.find("li[method='cerRegion'] span").eq(1).show();a.find("li[method='cerRegion'] input[method='txtBirthday']").show();a.find("li[method='Insurance']:eq(0) span[method='AirCardRegion']").hide();a.find("li[method='Insurance']:eq(0) li").eq(1).hide();a.find("li[method='Insurance']").each(function(){});a.find("li[method='cerRegion']").each(function(){$(this).show();});a.find("li[method='cerRegion']:eq(0) span").eq(0).show();a.find("li[method='cerRegion']:eq(0) select").show();a.find("li[method='cerRegion'] input[method='txtCertificateNo']").show();if(a.find("select[method='dlCertType']").val()=="0"){a.find("li[method='cerRegion'] span").eq(1).hide();a.find("li[method='cerRegion'] input[method='txtBirthday']").hide();}if(a.find("span[method='spanExtendedInsurance']").attr("display")=="True"&&a.find("select[method='dlCertType']").val()=="0"){a.find("li[method='cerRegion'] span").eq(1).hide();a.find("li[method='cerRegion'] input[method='txtBirthday']").hide();}a.find("li[method='InfantTip']").hide();}else{if(this.language!="EN"){a.find("li[method='Passenger']").hide();a.find("span[class~='passengertype']").appendTo(a.find("li[method='InfantRegion']:child:eq(0)"));a.find("li[method='InfantRegion']:child:eq(0)").find("input[method~='passengertype']:[value='2']").attr("checked","true");}else{a.find("li[method='cerRegion'] span").eq(1).attr("class","cols01");a.find("span[class~='passengertype']").appendTo(a.find("li[method='Passenger']"));a.find("li[method='Passenger']").find("input[method~='passengertype']:[value='2']").attr("checked","true");a.find("li[method='Passenger']").show();}a.find("li[method='InfantRegion']").each(function(){$(this).show();});a.find("li[method='cerRegion']:eq(0)").hide();a.find("li[method='cerRegion']:eq(0) span").eq(0).hide();a.find("li[method='cerRegion']:eq(0) select").hide();a.find("li[method='cerRegion'] input[method='txtCertificateNo']").hide();a.find("li[method='cerRegion'] span").eq(1).show();a.find("li[method='cerRegion'] input[method='txtBirthday']").show();a.find("li[method='Insurance']:eq(0) span[method='AirCardRegion']").hide();a.find("li[method='Insurance']:eq(0) li").eq(1).hide();a.find("li[method='InfantTip']").show();}}if(parseInt(a.find("select[method='dlInsurance']").val())>0||(a.find("span[method='spanExtendedInsurance']").attr("display")=="True"&&parseInt(a.find("select[method='dlExtendedInsurance']").val())>0)){a.find("li[method='Insurancetip']").show();}else{a.find("li[method='Insurancetip']").hide();}a.find("li[method='InfantRegion'] input[method='txtPassengerName']").each(function(){var c=$(this);if(c.val()==""){c.val(c.attr("default"));c.removeClass("black");}});},onClickDelivery:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"DeliveryType":this.displayDelivery(a.val());break;case"dlMlSelectProvince":this.ShowPCA(a);break;case"dlMlSelectCity":this.ShowPCA(a);break;case"dlMlSelectArea":this.ShowPCA(a);break;case"txtMlName":if(this.orderData.IsLogOn){FillOrderController.GetCustomerHistoryWithCity("mail","",function(e){if(e.success){var d=e.value;if(d&&d.length>0){new SelectDropListWindow({data:d,eventElement:this.formElement.txtMlName,fieldName:"MailingAllAddress",singleColumn:true,onSelected:function(g){var f=d[g];this.setMailInfoValue(f);}.bind(this)});}}}.bind(this));}break;default:break;}},onMouseoutFlightList:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"flightrule":case"StopOver":case"class":case"fee":this.contentEnd.html("");break;default:break;}},onMouseoverFlightList:function(b){var a=Event.element(b);var f=a.attr("method");switch(f){case"payactivity":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:350,defer:false,buildHtmlContent:function(i){i.htmlContent="<div><p class='mb5'>2014年1月1日-2月28日期间，成功预订国内机票，支付时选择储蓄卡，使用建行网银进行支付，即享好礼：</p><p class='mb5'> 1、每天前300个订单送20元话费</p><p> 2、每天抽取一个中奖订单，送该订单票面价格（不含税和保险）同等金额话费</p></div>";i.show();}});break;case"kseat":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){FillOrderController.GetKSeatDescription(function(j){if(j.success){i.htmlContent=j.value;i.show();}}.bind(this),true);}});break;case"onehour":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){if(this.language.toLowerCase()=="cn"){i.htmlContent="请在起飞前1小时完成预订，只接受国内信用卡支付。";i.show();}}.bind(this)});break;case"Channel_MU":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){i.htmlContent=this.resource.Channel_MU_Description;i.show();}.bind(this)});break;break;case"Channel_Book51":var a=Event.element(b);if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){i.htmlContent=this.resource.Channel_Book51_Description;i.show();}.bind(this)});break;case"promotelist":this.ShowPromoteList(a);break;case"Coupon":this.ShowPromoteList(a);break;case"flightrule":this.FlightRestriction(a);break;case"StopOver":var d=a.attr("flightno");this.StopOver(d,a);break;case"class":var d=a.attr("flightno");var c=a.attr("flightclass");var h=a.attr("way");this.ClassName(d,c,a,h);break;case"fee":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,defer:false,width:170,buildHtmlContent:function(i){i.htmlContent="<div>"+String.format(this.resource.TaxAndFee,a.attr("fee"),a.attr("tax"))+"</div>";i.show();}.bind(this)});break;case"dragon":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){i.htmlContent=this.resource.DragonTip;i.show();}.bind(this)});break;case"PackagePromotion":if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){i.htmlContent=this.resource.PackageBindInsurance;i.show();}.bind(this)});break;case"NoPackagePromotion":var e=a.attr("price");var g=parseInt(this.preprice.text())+parseInt(e);if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({eventElement:a,width:240,defer:false,buildHtmlContent:function(i){i.htmlContent=String.format(this.resource.NoPackageBindInsurance_Tip,g);i.show();}.bind(this)});break;default:break;}},ClassName:function(c,b,a,d){FillOrderController.ClassDescription(c,b,FillOrderController.OrderModel.RequestInfo,d,function(e){if(e.success){if(this.listWindow!=null){this.listWindow.close();}this.listWindow=new TipWindow({htmlContent:"<div >"+e.value+"</div>",eventElement:a,defer:false,width:240});}}.bind(this),true);},onMouseOverdvPassengerInfoRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"InsuranceDesc":this.showTimer=setTimeout(function(){this.showChildTip=null;if(this.showChildTip==null||this.showChildTip.windowElement==null){this.showChildTip=new TipWindow({htmlContent:"<div>"+FillOrderController.InsuranceInfo.InsuranceDescription+"</div>",eventElement:a,width:this.resource.InsuranceIntroWidth,height:this.resource.InsuranceIntroHight});}}.bind(this),600);break;case"childprice":var d=FillOrderController.OrderModel.ChildPrice;if(FillOrderController.isPromotionPackage==true){d=FillOrderController.PackageChildPrice;}if(this.showChildTip!=null){this.showChildTip.close();}this.showChildTip=new TipWindow({buildHtmlContent:function(e){if(this.language=="CN"){if(parseInt(d)>0){e.htmlContent="<ul id='pricelist'> <li><span class='price'>&yen;"+d+"</span>/儿童&nbsp;(不含税)</li></ul>";}}else{if(parseInt(d)>0){e.htmlContent="<ul id='pricelist'> <li><span class='price'>&yen;"+d+"</span>/child&nbsp;(Not Tax Included)</li></ul>";}}e.show();}.bind(this),eventElement:a,width:this.language=="CN"?160:200,defer:false});break;case"infantprice":var d=FillOrderController.OrderModel.InfantPrice;if(this.showChildTip!=null){this.showChildTip.close();}this.showChildTip=new TipWindow({buildHtmlContent:function(e){if(this.language=="CN"){if(parseInt(d)>0){e.htmlContent="<ul id='pricelist'> <li><span class='price'>&yen;"+d+"</span>/婴儿&nbsp;(不含税)</li></ul>";}}else{if(parseInt(d)>0){e.htmlContent="<ul id='pricelist'> <li><span class='price'>&yen;"+d+"</span>/Infant(Not Tax Included)</li></ul>";}}e.show();}.bind(this),eventElement:a,width:this.language=="CN"?140:200,defer:false});break;case"AddPassenger":if(a.attr("class")=="acs mo"){a.removeClass("asc mo").addClass("acs mo_b");}break;default:break;}},onMouseOutdvPassengerInfoRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"childprice":this.contentEnd.html("");break;case"AddPassenger":if(a.attr("class")=="acs mo_b"){a.removeClass("asc mo_b").addClass("acs mo");}break;default:break;}},onClickXiaofeiquan:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"coupon":$("#xiaofeiquan").hide();FillOrderController.UsedCoupon(this.cacheKey,function(d){if(d.success){$("#xiaofeiquan2").show();FillOrderController.OrderModel.IsUsedCoupon=true;}else{$("#xiaofeiquanFailed").show();}}.bind(this));break;}},onChangePassenger:function(d){var c=Event.element(d);var h=c.attr("method");c.addClass("black");var i=c.parents("div[class='passenger_wrap']").eq(0);var j=i.find("input[method='passengertype']:checked").val();switch(h){case"dlCertType":var f=FillOrderController.OrderModel.RequestInfo.FlightType;var a=FillOrderController.OrderModel.RequestInfo.ArriveCity;var b=FillOrderController.OrderModel.RequestInfo.DepartCity;var g=0;if(f=="OneWay"&&(a=="LXA"||a=="BPX"||a=="LZY")){g=1;}if(f=="RoundTrip"&&(a=="LXA"||a=="BPX"||a=="LZY"||b=="LXA"||b=="BPX"||b=="LZY")){g=1;}if(f=="MultiDest"){var e=FillOrderController.OrderModel.RequestInfo.First_ArriveCity;var k=FillOrderController.OrderModel.RequestInfo.Second_ArriveCity;if(e=="LXA"||e=="BPX"||e=="LZY"||k=="LXA"||k=="BPX"||k=="LZY"){g=1;}}if(g==1&&c.val()!=0&&c.val()!=2){this.error(c,this.resource.Js_PassengerCertificateToTibet);}this.switchPassenger(j,i);this.refreshAmount();if(i.find("input[method='txtCertificateNo']").val().trim()!=this.resource.Passenger_CertificateNo){i.find("input[method='txtCertificateNo']").blur();}break;case"dlInsurance":this.switchPassenger(j,i);this.refreshAmount();break;case"dlExtendedInsurance":this.switchPassenger(j,i);this.refreshAmount();break;default:break;}},error:function(a,b){$error(a,b);},onBlurinpinpCollection:function(b){var a=Event.element(b);a.removeClass("intxt_on");var c=a.attr("method");FunctionExt.defer(function(){this.validateInput(a);},200,this);switch(c){case"txtCertificateNo":if(a.val().toString().trim()==""){a.val(this.resource.Passenger_CertificateNo);}break;case"txtPassFName":if(a.val().trim()==""){a.attr("value",a.attr("default").trim());}break;case"txtPassLName":if(a.val().trim()==""){a.attr("value",a.attr("default").trim());}break;case"txtBirthday":if(a.val().trim()==""){a.attr("value",this.resource.DateTimeFormat);}break;case"txtEmail":if(a.val().toString().trim()==""){this.displayContact();}break;case"txtPassengerName":if(a.val().trim()==""){a.attr("value",a.attr("default"));}break;default:break;}},validateInput:function(d){var f=d.attr("method");var j=new RegExp("^[\u4e00-\u9fa5]{1}(([A-Za-z]*[\u4e00-\u9fa5]*)|([\u4e00-\u9fa5]*[A-Za-z]*))$");var i=new RegExp("^[\u4e00-\u9fa5 ]+$");var k=new RegExp("^[a-zA-Z ]+$");var g=d.parents("div[class='passenger_wrap']").eq(0);var h=g.find("input[method='passengertype']:checked").val();switch(f){case"txtCertificateNo":var b=g.find("select[method='dlCertType']:visible").val();if(b=="0"){var e=d.val();var a=this.GetBirthdayFromID(e);g.find("input[method='txtBirthday']").attr("value",a);}if(b!="4"){if(validator.valid(d.val(),"notEmpty")&&d.val()!=d.attr("default")){if(!validator.regularValidate(d.val(),new RegExp("^[A-Za-z0-9]+$"))){this.error(d,this.resource.Js_PassengerCertificateNO);}if(b=="0"&&!validator.valid(d.val(),"idCard")){this.error(d,this.resource.Js_PassengerIDNo);}}}else{if(validator.valid(d.val(),"notEmpty")&&d.val()!=d.attr("default")){if(!validator.regularValidate(d.val(),new RegExp("^[A-Za-z0-9|(|)|）|（]+$"))){this.error(d,this.resource.Js_PassengerCertificateNO);}}}break;case"txtPassengerName":if(h=="2"){if(validator.valid(d.val(),"notEmpty")){if(!validator.valid(d.val(),"cnString")||!validator.valid(d.val(),"textRange",3,16)){this.error(d,this.resource.Js_InfantNameLimit);}}}else{if(validator.valid(d.val(),"notEmpty")){if(!validator.valid(d.val(),"cnString")&&!validator.valid(d.val(),"passengerName")&&!validator.regularValidate(d.val(),j)){this.error(d,this.resource.Js_PassengerName);}if(validator.valid(d.val(),"cnString")&&!validator.valid(d.val(),"textRange",3,20)){this.error(d,this.resource.Js_AdultNameLimit);}if(validator.valid(d.val(),"passengerName")&&!validator.valid(d.val(),"textRange",1,27)){this.error(d,this.resource.Js_AdultNameEnLimit);}if(validator.regularValidate(d.val(),j)&&!validator.valid(d.val(),"textRange",1,27)){this.error(d,this.resource.Js_AdultNameEnLimit);}}}break;case"txtPassFName":if(validator.valid(d.val(),"notEmpty")&&d.val()!=d.attr("default")){if(!validator.regularValidate(d.val(),j)&&!validator.regularValidate(d.val(),k)){this.error(d,this.resource.Js_PassengerName);}}break;case"txtPassLName":if(validator.valid(d.val(),"notEmpty")&&d.val()!=d.attr("default")){if(!validator.regularValidate(d.val(),i)&&!validator.regularValidate(d.val(),k)){this.error(d,this.resource.Js_PassengerName);}}break;case"txtInfantName":if(h=="2"){if(this.language=="CN"){if(validator.valid(d.val(),"notEmpty")){if(!validator.valid(d.val(),"passengerName")){this.error(d,this.resource.Js_PassengerName);}if(validator.valid(d.val(),"passengerName")&&!validator.valid(d.val(),"textRange",1,17)){this.error(d,this.resource.Js_InfantNameEnLimit);}}}else{if(validator.valid(d.val(),"notEmpty")){if(!validator.valid(d.val(),"cnString")||!validator.valid(d.val(),"textRange",3,16)){this.error(d,this.resource.Js_InfantNameLimit);}}}}break;case"txtEmail":var l=this.language=="CN"?this.resource.Optional:this.resource.Required;if(d.val()!=l&&!validator.valid(d.val(),this.language=="CN"?"email":"email")){this.error(d,this.resource.Js_ContactEmail);}break;case"txtMobilePhone":if(this.language!="EN"){if(!validator.valid(d.val(),this.language=="CN"?"mobile":"number")){this.error(d,this.resource.Js_ContactMobile);}}break;case"txtMlName":var c=this.dvdelivery.find("input[method='DeliveryType']:checked").val();if(c=="1"){if(!validator.valid(d.val(),"nonSpecialSign")){this.error(d,this.resource.Js_NoMailName);}}break;case"txtMlPhone":var c=this.dvdelivery.find("input[method='DeliveryType']:checked").val();if(c=="1"){if(!validator.valid(d.val(),"mobile")){this.error(d,this.resource.Js_NoMailPhone);}}break;case"txtMlAddress":var c=this.dvdelivery.find("input[method='DeliveryType']:checked").val();if(c=="1"){if(!validator.valid(d.val(),"nonSpecialSign")){this.error(d,this.resource.Js_NoMailAddress);}if(validator.valid(d.val(),"textRange",1,8)){this.error(d,this.resource.Js_MailAddressLength);}if(d.val().substring(this.orderData.DelMail.Address.length-2,d.val().length)=="信箱"){this.error(d,this.resource.Js_DeliveryPost);}}break;case"txtMlInvoice":var c=this.dvdelivery.find("input[method='DeliveryType']:checked").val();if(c=="1"){if(!validator.valid(d.val(),"nonSpecialSign")){this.error(d,this.resource.Js_NoInvoiceTitle);}if(validator.valid(d.val(),"textRange",1,8)){this.error(d,this.resource.Js_MailAddressLength);}}break;default:break;}},onFocusinpinpCollection:function(b){var a=Event.element(b);a.addClass("intxt_on");},onKeypressdvPassengerInfoRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"txtPassengerName":this.showChildTip=new TipWindow({htmlContent:this.resource.Js_passengerkeypress,floatType:"rightTop",eventElement:a});break;case"txtPassFName":case"txtPassLName":this.showChildTip=new TipWindow({htmlContent:this.resource.Js_passengerkeypress,floatType:"rightTop",eventElement:a});break;default:break;}},onChangedvDeliveryRegion:function(b){var a=Event.element(b);var c=a.attr("method");a.addClass("black");switch(c){case"dlMlSelectProvince":this.GetPCA(a);break;case"dlMlSelectCity":this.GetPCA(a);break;case"dlMlSelectArea":this.GetPCA(a);break;default:break;}},onMouseOutdvDeliveryRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"position":this.contentEnd.html("");break;default:break;}},onMouseOverdvDeliveryRegion:function(c){var b=Event.element(c);var d=b.attr("method");switch(d){case"position":if(this.listWindow!=null){this.listWindow.close();}var a="";if(b.attr("map")!=""){a+="<img src='"+b.attr("map")+"'/><br/>";}if(b.attr("realmap")!=""){a+="<img src='"+b.attr("realmap")+"'/><br/>";}this.listWindow=new TipWindow({eventElement:b,htmlContent:a,width:400,defer:false});break;case"DeliveryTypeDesc":if(this.listWindow!=null){this.listWindow.close();}var a=$("#delivery div[method='deliverytype'][dltype='0']").eq(0).html();this.listWindow=new TipWindow({eventElement:b,htmlContent:a,width:400,defer:false});break;default:break;}},onKeyupdvDeliveryRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"txtMlAddress":clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.ShowStreet();}.bind(this),500);break;default:break;}},Login:function(a){$loginDialog(this.language,false,true,a,"",null);return;},onClickLogin:function(){$loginDialog(this.language,true,true,"","",function(a){switch(a){case 1:location.reload();break;case 2:break;}});},onClickbtnSaveOrder:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"btnSaveOrder":if(!this.validData()){return false;}a.addClass("com_btnout");a[0].disabled=true;FillOrderController.SaveOrder(this.orderData,function(h){if(h.success){a.removeClass("com_btnout");a[0].disabled=false;if(h.value=="remMe"){var e=h.message;FillOrderController.GetLoginStatus(function(k){if(k.success){if(k.value=true){this.Login(e);}}}.bind(this));}else{if(h.value!="gb2312"){window.location=h.value;}else{if(h.message!=""){if(this.language=="CN"){var d=parseInt(h.message);var g=this.dvpassenger.children("div[class='passenger_wrap']").eq(d);if(this.orderData.PassengerList[d].PassengerType=="2"){$error(g.find("input[method='txtInfantName']"),this.resource.PassengerGB2312ErrorMessage);}else{$error(g.find("input[method='txtPassengerName']"),this.resource.PassengerGB2312ErrorMessage);}}else{var f=h.message.split(",");var g=this.dvpassenger.children("div[class='passenger_wrap']").eq(parseInt(f[0]));if(f.length>0){if(f[1]=="F"){$error(g.find("input[method='txtPassLName']"),this.resource.PassengerGB2312ErrorMessageFamilyName);}else{$error(g.find("input[method='txtPassFName']"),this.resource.PassengerGB2312ErrorMessageGivenName);}}else{$error(g.find("input[method='txtPassLName']"),this.resource.PassengerGB2312ErrorMessage);}}}return;}}}else{if(h.value=="nokey"){window.location=h.message;}else{if(h.value=="blacklist"){var j=new Dialog({title:"",htmlContent:h.message,width:465,height:210,initEvent:function(m){var k=m.find("a.tip_close");k.bind("click",function(){j.close();});var l=m.find("a.btn");l.bind("click",function(){j.close();});}.bind(this)});j.show();this.btnSaveOrder.addClass("com_btnout");this.btnSaveOrder.disabled=true;return;}else{if(h.value=="nosession"){window.location=h.message;}else{if(h.value=="fail"||h.value=="cervalid"){alert(h.message);}else{if(h.value=="contrast_empty"){alert(this.resource.Js_Contrast_Description_Empty);}else{if(h.value=="contrast_length"){alert(this.resource.Js_Contrast_Description_Length);}else{if(h.value=="soldout"){location.href=h.message;}else{if(h.value=="notenoughtseat"){if(h.message!=null){var i=$("#ListURL").val();if(i.indexOf("refresh=1")<0){if(i.indexOf("?")>0){i=i+"&refresh=1";}else{i=i+"?refresh=1";}}this.resource.Js_LessSeat=this.resource.Js_LessSeat.replace("{N}",h.message).replace("{URL}",i);var j=new Dialog({title:"",htmlContent:this.resource.Js_LessSeat,width:600,height:160,initEvent:function(l){var k=l.find("input[type='button']");k.bind("click",function(){j.close();});}.bind(this)});j.show();}else{var i=$("#ListURL").val();if(i.indexOf("refresh=1")<0){if(i.indexOf("?")>0){i=i+"&refresh=1";}else{i=i+"?refresh=1";}}var j=new Dialog({title:"",htmlContent:this.resource.Js_NoSeat.replace("{URL}",i),width:600,height:160,initEvent:function(l){var k=l.find("input[type='button']");k.bind("click",function(){j.close();});}.bind(this)});j.show();}}}}}}}}}a.removeClass("com_btnout");a[0].disabled=false;}}.bind(this),false,"POST");break;default:break;}},onClickPassengerHistory:function(f){var d=Event.element(f);var i=d.attr("method");switch(i){case"HisExpandAll":var h=$(d).attr("class")=="ph_expand"?"block":"none";this.divpassengerhistory.find("li[method='passenger_history']").each(function(){$(this).css("display",h);});if($(d).attr("class")=="ph_expand"){$(d).attr("class","ph_collapse");}else{$(d).attr("class","ph_expand");}break;case"selectedpassenger":var b=0;var g=false;this.dvpassenger.find("div[class='passenger_wrap']").each(function(j,e){b++;if(this.language=="CN"){var k=$(e).find("input[method='txtPassengerName']");if(k.length>0){if(k.eq(0).val()==""){g=true;}}}else{var k=$(e).find("input[method='txtPassFName']");if(k.length>0){if(k.eq(0).val()==this.resource.Passenger_FirstName){g=true;}}}}.bind(this));try{if(d.attr("checked")){if(b<9){var a=this.dvpassenger.find("a[method='AddPassenger']").attr("class");if(a.indexOf("mo_disable")>0&&g==false){d.attr("checked",false);}else{this.AddPassengerfromHistory(d.attr("title"),parseFloat(d.attr("passengerid")));}}else{d.attr("checked",false);}}else{if(b<2){d.attr("checked",true);}else{this.RemovePassengerfromHistory(d.attr("title"));}}}catch(c){}break;default:break;}},onClickPassenger:function(l){var j=Event.element(l);var B=j.attr("method");var b=0;var e=0;var v=0;var y=parseInt(FillOrderController.MaxAdultPassengerCount);var z=parseInt(FillOrderController.MaxChildPassengerCount);var A=parseInt(FillOrderController.MaxInfantPassengerCount);this.dvpassenger.find("input[method='passengertype']:checked").each(function(){if($(this).val()=="0"){b++;}if($(this).val()=="1"){e++;}if($(this).val()=="2"){v++;}});switch(B){case"AddPassenger":var J=this.dvpassenger.find("input[method='passengertype']:checked").val();var o=this.dvpassenger.find("div:child:eq(0)");var H=o.clone(true);o.find("input[method='passengertype'][value='"+J+"']").attr("checked","true");var I;if(J==2&&this.language!="EN"){I=H.find("li[method='InfantRegion']:eq(0) span[class~='passengertype']");}else{I=H.find("li[method='Passenger'] span[class~='passengertype']");}if(b<=y&&e<=z&&v<=A&&b+e+v+1<=y+z+A&&b+e+1<=parseInt(FillOrderController.MinTicketCount)){var r="<input name=PassengerType_"+this.passengerIndex+">";var F="input";var j=$.browser.msie?r:F;if($.browser.msie){var s=(parseInt($.browser.version,10));if(s==9||s==10){j=F;}}var a=document.createElement(j);a.type="radio";a.id="PassengerType_"+this.passengerIndex;a.name="PassengerType_"+this.passengerIndex;a.className="type01";a.value=0;$(a).attr("method","passengertype");var d=document.createElement(j);d.type="radio";d.id="PassengerType_"+this.passengerIndex;d.name="PassengerType_"+this.passengerIndex;d.value=1;d.className="type02";$(d).attr("method","passengertype");var u=document.createElement(j);u.type="radio";u.id="PassengerType_"+this.passengerIndex;u.name="PassengerType_"+this.passengerIndex;u.value=2;u.className="type02";$(u).attr("method","passengertype");I.find("input[method='passengertype']").each(function(){$(this).remove();});$(a).insertBefore(I.find("label").eq(0));$(d).insertAfter(I.find("label").eq(0));$(u).insertBefore(I.find("a[method='infantprice']").parents("label:eq(0)"));H.insertBefore(this.dvContactInfoRegion);if(J==2){I.appendTo(H.find("li[method='InfantRegion']:child:eq(0)"));}else{I.appendTo(H.find("li[method='Passenger']"));}if(b==y){I.find("input[method='passengertype'][value='0']").hide();I.find("label[typeid='0']").hide();}if(e==z){I.find("input[method='passengertype'][value='1']").hide();I.find("a[typeid='1']").hide();}if(v==A){I.find("input[method='passengertype'][value='2']").hide();I.find("a[typeid='2']").hide();}this.passengerIndex++;this.displayPassenger(I,H);var j=H.find("select[method='dlCertType']");var p=FillOrderController.OrderModel.RequestInfo.FlightType;var c=FillOrderController.OrderModel.RequestInfo.ArriveCity;var i=FillOrderController.OrderModel.RequestInfo.DepartCity;var w=0;if(p=="OneWay"&&(c=="LXA"||c=="BPX"||c=="LZY")){w=1;}if(p=="RoundTrip"&&(c=="LXA"||c=="BPX"||c=="LZY"||i=="LXA"||i=="BPX"||i=="LZY")){w=1;}if(w==1&&j.val()!=0&&j.val()!=2){$error(j,this.resource.Js_PassengerCertificateToTibet);}}j.parents("div.passenger_wrap").attr("passengername","newPassenger");this.refreshAmount();break;case"DeletePassenger":if(b+e+v>1){var E=j.parents("div.passenger_wrap").attr("passengername");this.UncheckeSelectedPassengerHis(E);j.parents("div.passenger_wrap").remove();}this.refreshAmount();break;case"passengertype":var G=j.parents("div").eq(0);this.switchPassenger(j.val(),G);this.setInsurance(j.val(),G);this.refreshAmount();break;case"txtPassengerName":this.displayCustomerHistory(j);j.parents("div.passenger_wrap").attr("passengername");if(j.val().trim()==this.resource.Optional){j.attr("value","");}break;case"txtPassFName":if(j.val().trim()==j.attr("default").trim()){j.attr("value","");}this.displayCustomerHistory(j);break;case"txtPassLName":if(j.val().trim()==j.attr("default").trim()){j.attr("value","");}break;case"txtPassMName":if(j.val().trim()==j.attr("default").trim()){j.attr("value","");}break;case"txtBirthday":if(j.val()==this.resource.DateTimeFormat){j.attr("value","");}var O=0;var C=0;var h=0;if(FillOrderController.DateRange[1].indexOf("-")>-1){var g=FillOrderController.DateRange[1].split("-");if(g.length!=3){return"";}O=new Number(g[0]);C=new Number(g[1])-1;h=new Number(g[2]);}var k=new Date();k.setFullYear(O,C,h);var q=new Date();q.setFullYear(O,C,h);q.setTime(q.getTime()+24*60*60*1000);var M=new Date();M.setTime(q.getTime()-24*60*60*1000);var L=new Date();if(L.getTime()<k.getTime()){k=L;}var f=j.parents("div").eq(0);if(f.find("input[method='passengertype']:checked").val()=="0"){this.FromDate=validator.reFormatDateString(q.getFullYear()-100+"-"+(q.getMonth()+1)+"-"+q.getDate());this.ToDate=validator.reFormatDateString(M.getFullYear()-12+"-"+(M.getMonth()+1)+"-"+M.getDate());}if(f.find("input[method='passengertype']:checked").val()=="1"){this.FromDate=validator.reFormatDateString(q.getFullYear()-12+"-"+(q.getMonth()+1)+"-"+q.getDate());this.ToDate=validator.reFormatDateString(M.getFullYear()-2+"-"+(M.getMonth()+1)+"-"+M.getDate());}if(f.find("input[method='passengertype']:checked").val()=="2"){this.FromDate=validator.reFormatDateString(q.getFullYear()-2+"-"+(q.getMonth()+1)+"-"+q.getDate());this.ToDate=validator.reFormatDateString(k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate());}if(validator.reFormatDateString(j.val()).indexOf("-")>-1){var g=validator.reFormatDateString(j.val()).split("-");if(g.length!=3){j.val("");}O=new Number(g[0]);C=new Number(g[1])-1;h=new Number(g[2]);var K=new Date();K.setFullYear(O,C,h);g=validator.reFormatDateString(this.FromDate).split("-");O=new Number(g[0]);C=new Number(g[1])-1;h=new Number(g[2]);var x=new Date();x.setFullYear(O,C,h);g=validator.reFormatDateString(this.ToDate).split("-");O=new Number(g[0]);C=new Number(g[1])-1;h=new Number(g[2]);var D=new Date();D.setFullYear(O,C,h);if(K.getTime()<x.getTime()||K.getTime()>D.getTime()){j.val("");}}if(this.cal!=null){this.cal.dispose();}this.cal=new CalendarWindow({language:this.language,eventElement:j,selectedDate:j.val()==""?this.ToDate:j.val(),enabledFrom:this.FromDate,enabledTo:this.ToDate,yearOrder:"d",winStyle:"s",onSelected:function(m){j.val(m);j.addClass("black");}.bind(this)});break;case"txtCertificateNo":if(j.val().trim()==this.resource.Passenger_CertificateNo){j.attr("value","");}break;case"txtEmail":var N=this.language=="CN"?this.resource.Optional:this.resource.Required;if(j.val().trim()==N.trim()){j.attr("value","");}break;default:break;}}});var client=null;$(document).ready(function(){client=new FillOrderClient();});